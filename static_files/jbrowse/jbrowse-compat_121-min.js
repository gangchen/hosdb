var dojof;var _gaq=_gaq||[];var Browser=function(b){dojo.require("dojox.lang.functional");dojo.require("dojox.lang.functional.array");dojo.require("dojox.lang.functional.fold");dojof=dojox.lang.functional;dojo.require("dojo.dnd.Source");dojo.require("dojo.dnd.Moveable");dojo.require("dojo.dnd.Mover");dojo.require("dojo.dnd.move");dojo.require("dijit.layout.ContentPane");dojo.require("dijit.layout.BorderContainer");dojo.require("dijit.Dialog");this.deferredFunctions=[];this.globalKeyboardShortcuts={};this.isInitialized=false;this.config=b;this.startTime=Date.now();this.deferredFunctions.push(function(){loadTouch()});var a=this;dojo.addOnLoad(function(){a.loadConfig()});dojo.connect(this,"onConfigLoaded",Util.debugHandler(this,"loadRefSeqs"));dojo.connect(this,"onConfigLoaded",Util.debugHandler(this,"loadNames"));dojo.connect(this,"onRefSeqsLoaded",Util.debugHandler(this,"initView"));dojo.connect(this,"onRefSeqsLoaded",Util.debugHandler(this,"reportUsageStats"))};Browser.prototype.fatalError=function(b){if(b){b=b+"";if(!/\.$/.exec(b)){b=b+"."}}if(!this.hasFatalErrors){var a=dojo.byId(this.config.containerID||"GenomeBrowser")||document.body;a.innerHTML='<div class="fatal_error">  <h1>Congratulations, JBrowse is on the web!</h1>  <p>However, JBrowse could not start, either because it has not yet been configured     and loaded with data, or because of an error.</p>  <p style="font-size: 110%; font-weight: bold"><a title="View the tutorial" href="docs/tutorial/">If this is your first time running JBrowse, click here to follow the Quick-start Tutorial to get up and running.</a></p>  <p>Otherwise, please refer to the following resources for help in getting JBrowse up and running.</p>  <ul><li><a target="_blank" href="docs/tutorial/">Quick-start tutorial</a></li>      <li><a target="_blank" href="http://gmod.org/wiki/JBrowse">JBrowse wiki</a></li>      <li><a target="_blank" href="docs/config.html">Configuration reference</a></li>      <li><a target="_blank" href="docs/featureglyphs.html">Feature glyph reference</a></li>  </ul>  <div id="fatal_error_list" class="errors"> <h2>Error message(s):</h2>'+(b?'<div class="error"> '+b+"</div>":"")+"  </div></div>";this.hasFatalErrors=true}else{var c=dojo.byId("fatal_error_list")||document.body;dojo.create("div",{className:"error",innerHTML:b+""},c)}};Browser.prototype.loadRefSeqs=function(){if(typeof this.config.refSeqs=="string"){this.config.refSeqs={url:this.config.refSeqs}}dojo.xhrGet({url:this.config.refSeqs.url,handleAs:"json",load:dojo.hitch(this,function(a){this.addRefseqs(a);this.onRefSeqsLoaded()})})};Browser.prototype.onRefSeqsLoaded=function(){};Browser.prototype.loadNames=function(){if(this.config.nameUrl){this.names=new LazyTrie(this.config.nameUrl,"lazy-{Chunk}.json")}};Browser.prototype.initView=function(){dojo.addClass(document.body,"tundra");this.container=dojo.byId(this.config.containerID);this.container.onselectstart=function(){return false};this.container.genomeBrowser=this;var d=dojo.create("div",{style:{overflow:"hidden"}},this.container);var f=dojo.create("div",{className:"overview",id:"overview"},d);if(this.config.show_overview==0){f.style.cssText="display: none"}if(this.config.show_nav!=0){this.navbox=this.createNavBox(d,25)}var e=dojo.create("div",{className:"topLink"});dojo.create("a",{className:"powered_by",innerHTML:"JBrowse",href:"http://jbrowse.org",title:"powered by JBrowse"},e);e.appendChild(this.makeBookmarkLink());if(this.config.show_nav!=0){e.appendChild(this.makeHelpDialog())}(this.config.show_nav==0?this.container:this.navbox).appendChild(e);this.viewElem=document.createElement("div");this.viewElem.className="dragWindow";this.container.appendChild(this.viewElem);this.containerWidget=new dijit.layout.BorderContainer({liveSplitters:false,design:"sidebar",gutters:false},this.container);var c=new dijit.layout.ContentPane({region:"top"},d);this.browserWidget=new dijit.layout.ContentPane({region:"center"},this.viewElem);if(this.config.show_nav!=0){this.locationTrap=dojo.create("div",{className:"locationTrap"},d);this.locationTrap.className="locationTrap"}this.view=this.viewElem.view=new GenomeView(this,this.viewElem,250,this.refSeq,1/200,this.config.browserRoot);dojo.connect(this.view,"onFineMove",this,"onFineMove");dojo.connect(this.view,"onCoarseMove",this,"onCoarseMove");var b=this.createTrackList();this.containerWidget.startup();dojo.connect(this.browserWidget,"resize",this,"onResize");dojo.connect(this.browserWidget,"resize",this.view,"onResize");this.onResize();this.view.onResize();var a=dojo.fromJson(this.cookie("location"))||{};if(this.config.location){this.navigateTo(this.config.location)}else{if(a[this.refSeq.name]){this.navigateTo(a[this.refSeq.name].l||a[this.refSeq.name])}else{if(this.config.defaultLocation){this.navigateTo(this.config.defaultLocation)}else{this.navigateTo(Util.assembleLocString({ref:this.refSeq.name,start:0.4*(this.refSeq.start+this.refSeq.end),end:0.6*(this.refSeq.start+this.refSeq.end)}))}}}dojo.connect(document.body,"onkeypress",this,"globalKeyHandler");this._initEventRouting();this.isInitialized=true;dojo.forEach(this.deferredFunctions,function(g){g.call(this)},this);this.deferredFunctions=[]};Browser.prototype._initEventRouting=function(){this.subscribe("/jbrowse/v1/v/tracks/hide",this,function(){this.publish("/jbrowse/v1/c/tracks/hide",arguments)});this.subscribe("/jbrowse/v1/v/tracks/show",this,function(a){this.addRecentlyUsedTracks(dojo.map(a,function(b){return b.label}));this.publish("/jbrowse/v1/c/tracks/show",arguments)})};Browser.prototype.reportUsageStats=function(){if(this.config.suppressUsageStatistics){return}var a=this._calculateClientStats();this._reportGoogleUsageStats(a);this._reportCustomUsageStats(a)};Browser.prototype._reportGoogleUsageStats=function(a){_gaq.push.apply(_gaq,[["_setAccount","UA-7115575-2"],["_setDomainName","none"],["_setAllowLinker",true],["_setCustomVar",1,"tracks-count",a["tracks-count"],3],["_setCustomVar",2,"refSeqs-count",a["refSeqs-count"],3],["_setCustomVar",3,"refSeqs-avgLen",a["refSeqs-avgLen"],3],["_setCustomVar",4,"jbrowse-version",a.ver,3],["_setCustomVar",5,"loadTime",a.loadTime,3],["_trackPageview"]]);var c=document.createElement("script");c.type="text/javascript";c.async=true;c.src=("https:"==document.location.protocol?"https://ssl":"http://www")+".google-analytics.com/ga.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(c,b)};Browser.prototype._reportCustomUsageStats=function(a){dojo.create("img",{style:{display:"none"},src:"http://jbrowse.org/analytics/clientReport?"+dojo.objectToQuery(a)},document.body)};Browser.prototype._calculateClientStats=function(){var a=screen||window.screen;var b=new Date();var c={ver:this.version||"dev","refSeqs-count":this.refSeqOrder.length,"refSeqs-avgLen":!this.refSeqOrder.length?null:dojof.reduce(dojo.map(this.refSeqOrder,function(d){var e=this.allRefs[d];if(!e){return 0}return e.end-e.start},this),"+"),"tracks-count":this.config.tracks.length,"scn-h":a?a.height:null,"scn-w":a?a.width:null,"win-h":document.body.offsetHeight,"win-w":document.body.offsetWidth,"el-h":this.container.offsetHeight,"el-w":this.container.offsetWidth,t:b.getTime()/1000,tzoffset:b.getTimezoneOffset(),loadTime:(b.getTime()-this.startTime)/1000};dojo.forEach(this.config.tracks,function(e){var d="track-types-"+e.type||"null";c[d]=(c[d]||0)+1});return c};Browser.prototype.publish=function(){return dojo.publish.apply(dojo,arguments)};Browser.prototype.subscribe=function(){return dojo.subscribe.apply(dojo,arguments)};Browser.prototype.onResize=function(){if(this.navbox){this.view.locationTrapHeight=dojo.marginBox(this.navbox).h}};Browser.prototype.getRecentlyUsedTracks=function(){return dojo.fromJson(this.cookie("recentTracks")||"[]")};Browser.prototype.addRecentlyUsedTracks=function(b){var a={};var c=Util.uniq(dojo.map(b,function(d){return{label:d,time:Math.round(new Date()/1000)}},this).concat(dojo.fromJson(this.cookie("recentTracks"))||[]),function(d){return d.label}).slice(0,this.config.maxRecentTracks||10);this.cookie("recentTracks",c,{expires:365});return c};Browser.prototype.loadConfig=function(){var c=this;if(typeof this.config.include!="object"||!this.config.include.length){this.config.include=[this.config.include]}for(var b=0;b<this.config.include.length;b++){if(typeof this.config.include[b]=="string"){this.config.include[b]={url:this.config.include[b]}}}var a=this.config.include.length;dojo.forEach(this.config.include,function(d){if(!d){return}if(!("format" in d)){d.format="JB_json"}if(d.format=="JB_json"&&!("version" in d)){d.version=1}var e=this.getConfigAdaptor(d);if(!e){this.fatalError("Could not load config "+d.url+", no configuration adaptor found for config format "+d.format+" version "+d.version);return}e.load({config:d,context:this,onSuccess:function(f,g){d.data=f;d.loaded=true;if(!--a){this.onConfigLoaded()}},onFailure:function(f){d.loaded=false;this.fatalError(f);if(!--a){this.onConfigLoaded()}}})},this)};Browser.prototype.onConfigLoaded=function(){var a=this.config;this.config={};dojo.forEach(a.include,function(b){if(b.loaded&&b.data){this.addConfigData(b.data)}},this);this.addConfigData(a);this.validateConfig();this.trackConfigsByName={};dojo.forEach(this.config.tracks||[],function(b){this.trackConfigsByName[b.label]=b},this)};Browser.prototype.validateConfig=function(){var a=this.config;if(!a.tracks){this.fatalError("No tracks defined in configuration")}if(!a.baseUrl){this.fatalError("Must provide a <code>baseUrl</code> in configuration")}if(this.hasFatalErrors){throw"Errors in configuration, aborting."}};Browser.prototype.getConfigAdaptor=function(config_def){var adaptor_name="ConfigAdaptor."+config_def.format;if("version" in config_def){adaptor_name+="_v"+config_def.version}adaptor_name.replace(/\W/g,"");var adaptor_class=eval(adaptor_name);if(!adaptor_class){return undefined}return new adaptor_class(config_def)};Browser.prototype.addDeferred=function(a){if(this.isInitialized){a()}else{this.deferredFunctions.push(a)}};Browser.prototype.addConfigData=function(a){Util.deepUpdate(this.config,a)};Browser.prototype.addRefseqs=function(a){this.allRefs=this.allRefs||{};this.refSeqOrder=this.refSeqOrder||[];var b=this.cookie("refseq");dojo.forEach(a,function(c){if(!this.allRefs[c.name]){this.refSeqOrder.push(c.name)}this.allRefs[c.name]=c;if(b&&c.name.toLowerCase()==b.toLowerCase()){this.refSeq=c}},this);this.refSeqOrder=this.refSeqOrder.sort();this.refSeq=this.refSeq||a[0]};Browser.prototype.onFineMove=function(d,b){if(this.locationTrap){var e=this.view.ref.end-this.view.ref.start;var a=Math.round((((d-this.view.ref.start)/e)*this.view.overviewBox.w)+this.view.overviewBox.l);var f=Math.round((((b-this.view.ref.start)/e)*this.view.overviewBox.w)+this.view.overviewBox.l);var c=dojo.isIE?"top: "+this.view.overviewBox.t+"px;height: "+this.view.overviewBox.h+"px;left: "+a+"px;width: "+(f-a)+"px;border-width: 0px":"top: "+this.view.overviewBox.t+"px;height: "+this.view.overviewBox.h+"px;left: "+this.view.overviewBox.l+"px;width: "+(f-a)+"px;border-width: 0px "+(this.view.overviewBox.w-f)+"px "+this.view.locationTrapHeight+"px "+a+"px;";this.locationTrap.style.cssText=c}};Browser.prototype.createTrackList=function(){if(!this.config.tracks){this.config.tracks=[]}if(this.config.sourceUrl){dojo.forEach(this.config.tracks,function(t){if(!t.baseUrl){t.baseUrl=this.config.baseUrl}},this)}var resolved_tl_class=function(){var tl_class=this.config.show_tracklist==0?"Null":(this.config.trackSelector||{}).type?this.config.trackSelector.type:"Simple";return JBrowse.View.TrackList[tl_class]||eval(tl_class.replace(/[^\.\w\d]/g,""))}.call(this);if(!resolved_tl_class){console.error("configured trackSelector.type "+tl_class+" not found, falling back to JBrowse.View.TrackList.Simple");resolved_tl_class=JBrowse.View.TrackList.Simple}var trackMeta=new JBrowse.Model.TrackMetaData(dojo.mixin(this.config.trackMetadata||{},{trackConfigs:this.config.tracks,browser:this,metadataStores:dojo.map((this.config.trackMetadata||{}).sources||[],function(sourceDef){var url=sourceDef.url||"trackMeta.csv";var type=sourceDef.type||(/\.csv$/i.test(url)?"csv":/\.js(on)?$/i.test(url)?"json":"csv");var storeClass=sourceDef["class"]||{csv:"dojox.data.CsvStore",json:"dojox.data.JsonRestStore"}[type];if(!storeClass){console.error("No store class found for type '"+type+"', cannot load track metadata from URL "+url);return null}try{eval(storeClass)||dojo.require(storeClass)}catch(x){console.error("Could not load trackMetaSource class "+storeClass+": "+x)}return new (eval(storeClass))({url:url})},this)}));this.trackListView=new resolved_tl_class(dojo.mixin(dojo.clone(this.config.trackSelector)||{},{trackConfigs:this.config.tracks,browser:this,trackMetaData:trackMeta}));this.setGlobalKeyboardShortcut("t",this.trackListView,"toggle");this.subscribe("/jbrowse/v1/v/tracks/hide",this,"onVisibleTracksChanged");this.subscribe("/jbrowse/v1/v/tracks/show",this,"onVisibleTracksChanged");var origTracklist=this.config.forceTracks||this.cookie("tracks")||this.config.defaultTracks||"DNA";this.showTracks(origTracklist)};Browser.prototype.onVisibleTracksChanged=function(){this.view.updateTrackList();this.cookie("tracks",this.visibleTracks().join(","),{expires:60})};Browser.prototype.navigateTo=function(e){if(!this.isInitialized){this.deferredFunctions.push(function(){this.navigateTo(e)});return}var b=Util.parseLocString(e);if(b){this.navigateToLocation(b)}else{var d=Util.matchRefSeqName(e,this.allRefs);if(d){var c;try{c=Util.parseLocString(dojo.fromJson(this.cookie("location"))[d.name].l);c.ref=d.name}catch(a){}if(c){this.navigateToLocation(c)}else{this.navigateToLocation({ref:d.name,start:d.end*0.1,end:d.end*0.9})}}this.searchNames(e)}};Browser.prototype.navigateToLocation=function(a){var c=a.ref?Util.matchRefSeqName(a.ref,this.allRefs):this.refSeq;if(!c){return}a.ref=c.name;a.start=Math.max(0,a.start||0);a.end=Math.max(a.start,Math.min(c.end,a.end||c.end));if(a.ref==this.refSeq.name){this.view.setLocation(this.refSeq,a.start,a.end)}else{var b=this.visibleTracks();this.refSeq=this.allRefs[a.ref];this.view.setLocation(this.refSeq,a.start,a.end);this.showTracks(b)}return};Browser.prototype.searchNames=function(b){var a=this;this.names.exactMatch(b,function(j){var h,e;var g=typeof j[0][0]=="string";for(e=0;e<j.length;e++){if(j[e][g?0:1]==b){h=j[e]}}if(!h){for(e=0;e<j.length;e++){if(j[e][g?0:1].toLowerCase()==b.toLowerCase()){h=j[e]}}}if(!h){h=j[0]}var f=parseInt(h[g?4:3]);var d=parseInt(h[g?5:4]);var c=Math.round((d-f)*0.2);a.navigateTo(h[g?3:2]+":"+(f-c)+".."+(d+c));a.showTracks(a.names.extra[j[0][g?1:0]])})};Browser.prototype.showTracks=function(b){if(!this.isInitialized){this.deferredFunctions.push(function(){this.showTracks(b)});return}if(typeof b=="string"){b=b.split(",")}if(!b){return}var a=dojo.filter(dojo.map(b,function(c){return this.trackConfigsByName[c]},this),function(d){return d});dojo.publish("/jbrowse/v1/c/tracks/show",[a]);dojo.publish("/jbrowse/v1/n/tracks/visibleChanged")};Browser.prototype.visibleRegion=function(){return Util.assembleLocString({ref:this.view.ref.name,start:this.view.minVisible(),end:this.view.maxVisible()})};Browser.prototype.visibleTracks=function(){return dojo.map(this.view.visibleTracks(),function(a){return a.name})};Browser.prototype.makeHelpDialog=function(){var d=this.config.browserRoot||"";var a=document.createElement("div");a.style.display="none";a.className="helpDialog";a.innerHTML='<div class="main" style="float: left; width: 49%;"><dl><dt>Moving</dt><dd><ul>    <li>Move the view by clicking and dragging in the track area, or by clicking <img height="20px" src="'+d+'img/slide-left.png"> or <img height="20px"  src="'+d+'img/slide-right.png"> in the navigation bar.</li>    <li>Center the view at a point by clicking on either the track scale bar or overview bar, or by shift-clicking in the track area.</li></ul></dd><dt>Zooming</dt><dd><ul>    <li>Zoom in and out by clicking <img height="20px" src="'+d+'img/zoom-in-1.png"> or <img height="20px"  src="'+d+'img/zoom-out-1.png"> in the navigation bar.</li>    <li>Select a region and zoom to it ("rubber-band" zoom) by clicking and dragging in the overview or track scale bar, or shift-clicking and dragging in the track area.</li>    </ul></dd><dt>Selecting Tracks</dt><dd><ul><li>Turn a track off by dragging its track label from the "Available Tracks" area into the track area.</li>        <li>Turn a track on by dragging its track label from the track area back into the "Available Tracks" area.</li>    </ul></dd></dl></div><div class="main" style="float: right; width: 49%;"><dl><dt>Searching</dt><dd><ul>    <li>Jump to a feature or reference sequence by typing its name in the search box and pressing Enter.</li>    <li>Jump to a specific region by typing the region into the search box as: <span class="example">ref:start..end</span>.</li>    </ul></dd><dt>Example Searches</dt><dd>    <dl class="searchexample">        <dt>uc0031k.2</dt><dd>jumps to the feature named <span class="example">uc0031k.2</span>.</dd>        <dt>chr4</dt><dd>jumps to chromosome 4</dd>        <dt>chr4:79,500,000..80,000,000</dt><dd>jumps the region on chromosome 4 between 79.5Mb and 80Mb.</dd>    </dl></dd><dt>JBrowse Configuration</dt><dd><ul><li><a target="_blank" href="docs/tutorial/">Quick-start tutorial</a></li>        <li><a target="_blank" href="http://gmod.org/wiki/JBrowse">JBrowse wiki</a></li>        <li><a target="_blank" href="docs/config.html">Configuration reference</a></li>        <li><a target="_blank" href="docs/featureglyphs.html">Feature glyph reference</a></li>    </ul></dd></dl></div>';this.container.appendChild(a);var c=new dijit.Dialog({"class":"help_dialog",refocus:false,draggable:false,title:"JBrowse Help"},a);var b=document.createElement("a");b.className="topLink";b.title="Help";b.style.cursor="help";b.appendChild(document.createTextNode("Help"));dojo.connect(b,"onclick",function(){c.show()});this.setGlobalKeyboardShortcut("?",c,"show");dojo.connect(document.body,"onkeydown",function(e){if(e.keyCode!=dojo.keys.SHIFT&&e.keyCode!=dojo.keys.CTRL&&e.keyCode!=dojo.keys.ALT){c.hide()}});return b};Browser.prototype.setGlobalKeyboardShortcut=function(b){if(this.globalKeyboardShortcuts[b]){console.warn("WARNING: JBrowse global keyboard shortcut '"+b+"' redefined")}var a=dojo.hitch.apply(dojo,Array.prototype.slice.call(arguments,1));this.globalKeyboardShortcuts[b]=a};Browser.prototype.globalKeyHandler=function(b){var a=this.globalKeyboardShortcuts[b.keyChar];if(a){a.call(this);b.stopPropagation()}};Browser.prototype.makeBookmarkLink=function(a){if(typeof this.config.bookmark!="undefined"&&!this.config.bookmark){return null}if(typeof this.config.bookmark!="function"){this.config.bookmark=function(d){return"".concat(window.location.protocol,"//",window.location.host,window.location.pathname,"?",dojo.objectToQuery({loc:d.visibleRegion(),tracks:d.visibleTracks().join(","),data:d.config.queryParams.data}))}}var c=this.config.show_nav==0||this.config.show_tracklist==0||this.config.show_overview==0;this.link=document.createElement("a");this.link.className="topLink";this.link.href=window.location.href;if(c){this.link.target="_blank"}this.link.title=c?"View in full browser":"Bookmarkable link to this view";this.link.appendChild(document.createTextNode(c?"Full view":"Bookmark"));var b=function(){this.link.href=this.config.bookmark.call(this,this)};dojo.connect(this,"onCoarseMove",b);dojo.connect(this,"onVisibleTracksChanged",b);return this.link};Browser.prototype.onCoarseMove=function(e,d){var f=this.view.ref.end-this.view.ref.start;var c=Math.round((((e-this.view.ref.start)/f)*this.view.overviewBox.w)+this.view.overviewBox.l);var g=Math.round((((d-this.view.ref.start)/f)*this.view.overviewBox.w)+this.view.overviewBox.l);this.view.locationThumb.style.cssText="height: "+(this.view.overviewBox.h-4)+"px; left: "+c+"px; width: "+(g-c)+"px;z-index: 20";if(!this.isInitialized){return}var a=Util.assembleLocString({start:e,end:d,ref:this.refSeq.name});if(this.locationBox){this.locationBox.set("value",a,false);this.goButton.set("disabled",true)}var b=dojo.fromJson(this.cookie("location"))||{_version:1};if(!b._version){b=this._migrateLocMap(b)}b[this.refSeq.name]={l:a,t:Math.round((new Date()).getTime()/1000)-1340211510};b=this._limitLocMap(b,this.config.maxSavedLocations||10);this.cookie("location",dojo.toJson(b),{expires:60});this.cookie("refseq",this.refSeq.name);document.title=a};Browser.prototype._migrateLocMap=function(b){var a={_version:1};for(var c in b){a[c]={l:b[c],t:0}}return a};Browser.prototype._limitLocMap=function(a,c){var d=dojof.keys(a);if(d.length<=c){return a}a=dojo.clone(a);var b=d.sort(function(f,e){return a[e].t-a[f].t}).slice(c-1);dojo.forEach(b,function(e){delete a[e]});return a};Browser.prototype.cookie=function(){arguments[0]=this.config.containerID+"-"+arguments[0];if(typeof arguments[1]=="object"){arguments[1]=dojo.toJson(arguments[1])}var a=this.config.cookieSizeLimit||1200;if(arguments[1]&&arguments[1].length>a){console.warn("not setting cookie '"+arguments[0]+"', value too big ("+arguments[1].length+" > "+a+")");return dojo.cookie(arguments[0])}return dojo.cookie.apply(dojo.cookie,arguments)};Browser.prototype.createNavBox=function(parent,locLength){var navbox=document.createElement("div");var browserRoot=this.config.browserRoot?this.config.browserRoot:"";navbox.id="navbox";parent.appendChild(navbox);navbox.style.cssText="text-align: center; z-index: 10;";var four_nbsp=String.fromCharCode(160);four_nbsp=four_nbsp+four_nbsp+four_nbsp+four_nbsp;navbox.appendChild(document.createTextNode(four_nbsp));var moveLeft=document.createElement("input");moveLeft.type="image";moveLeft.src=browserRoot+"img/slide-left.png";moveLeft.id="moveLeft";moveLeft.className="icon nav";moveLeft.style.height="40px";navbox.appendChild(moveLeft);dojo.connect(moveLeft,"click",this,function(event){dojo.stopEvent(event);this.view.slide(0.9)});var moveRight=document.createElement("input");moveRight.type="image";moveRight.src=browserRoot+"img/slide-right.png";moveRight.id="moveRight";moveRight.className="icon nav";moveRight.style.height="40px";navbox.appendChild(moveRight);dojo.connect(moveRight,"click",this,function(event){dojo.stopEvent(event);this.view.slide(-0.9)});navbox.appendChild(document.createTextNode(four_nbsp));var bigZoomOut=document.createElement("input");bigZoomOut.type="image";bigZoomOut.src=browserRoot+"img/zoom-out-2.png";bigZoomOut.id="bigZoomOut";bigZoomOut.className="icon nav";bigZoomOut.style.height="40px";navbox.appendChild(bigZoomOut);dojo.connect(bigZoomOut,"click",this,function(event){dojo.stopEvent(event);this.view.zoomOut(undefined,undefined,2)});var zoomOut=document.createElement("input");zoomOut.type="image";zoomOut.src=browserRoot+"img/zoom-out-1.png";zoomOut.id="zoomOut";zoomOut.className="icon nav";zoomOut.style.height="40px";navbox.appendChild(zoomOut);dojo.connect(zoomOut,"click",this,function(event){dojo.stopEvent(event);this.view.zoomOut()});var zoomIn=document.createElement("input");zoomIn.type="image";zoomIn.src=browserRoot+"img/zoom-in-1.png";zoomIn.id="zoomIn";zoomIn.className="icon nav";zoomIn.style.height="40px";navbox.appendChild(zoomIn);dojo.connect(zoomIn,"click",this,function(event){dojo.stopEvent(event);this.view.zoomIn()});var bigZoomIn=document.createElement("input");bigZoomIn.type="image";bigZoomIn.src=browserRoot+"img/zoom-in-2.png";bigZoomIn.id="bigZoomIn";bigZoomIn.className="icon nav";bigZoomIn.style.height="40px";navbox.appendChild(bigZoomIn);dojo.connect(bigZoomIn,"click",this,function(event){dojo.stopEvent(event);this.view.zoomIn(undefined,undefined,2)});navbox.appendChild(document.createTextNode(four_nbsp));dojo.require("dijit.form.ComboBox");this.locationBox=new dijit.form.ComboBox({id:"location",name:"location",store:this._makeLocationAutocompleteStore(),searchAttr:"name"},dojo.create("input",{size:locLength},navbox));dojo.connect(this.locationBox.focusNode,"keydown",this,function(event){if(event.keyCode==dojo.keys.ENTER){this.locationBox.closeDropDown(false);this.navigateTo(this.locationBox.get("value"));this.goButton.set("disabled",true);dojo.stopEvent(event)}else{this.goButton.set("disabled",false)}});dojo.connect(navbox,"onselectstart",function(evt){evt.stopPropagation();return true});(function(){var dropDownProto=eval(this.locationBox.dropDownClass).prototype;var oldCreateOption=dropDownProto._createOption;dropDownProto._createOption=function(item){var option=oldCreateOption.apply(this,arguments);if(item.hitLimit){dojo.addClass(option,"moreMatches")}return option};var oldSetValue=dropDownProto._setValueAttr;dropDownProto._setValueAttr=function(value){console.log(value.target.item);if(value.target&&value.target.item&&value.target.item.hitLimit){return null}return oldSetValue.apply(this,arguments)}}).call(this);dojo.require("dijit.form.Button");this.goButton=new dijit.form.Button({label:"Go",onClick:dojo.hitch(this,function(event){this.navigateTo(this.locationBox.get("value"));this.goButton.set("disabled",true);dojo.stopEvent(event)})},dojo.create("button",{},navbox));return navbox};Browser.prototype._makeLocationAutocompleteStore=function(){var a=this.config.autocomplete||{};return new JBrowse.Model.AutocompleteStore({namesTrie:this.names,stopPrefixes:a.stopPrefixes,resultLimit:a.resultLimit||15})};var ConfigAdaptor;if(!ConfigAdaptor){ConfigAdaptor={}}ConfigAdaptor.JB_json_v1=function(){};ConfigAdaptor.JB_json_v1.prototype.load=function(a){var b=this;dojo.xhrGet({url:a.config.url,handleAs:"text",load:function(c){c=b.parse_conf(c,a);c=b.regularize_conf(c,a);a.onSuccess.call(a.context||this,c)},error:function(c){console.error(""+c);if(a.onFailure){a.onFailure.call(a.context||this,c)}}})};ConfigAdaptor.JB_json_v1.prototype.parse_conf=function(conf_text,load_args){var conf;return eval("conf = "+conf_text)};ConfigAdaptor.JB_json_v1.prototype.regularize_conf=function(b,a){b.sourceUrl=b.sourceUrl||a.config.url;b.baseUrl=b.baseUrl||Util.resolveUrl(b.sourceUrl,".");if(!/\/$/.test(b.baseUrl)){b.baseUrl+="/"}return b};var ConfigAdaptor;if(!ConfigAdaptor){ConfigAdaptor={}}ConfigAdaptor.JB_json_v0=function(){};ConfigAdaptor.JB_json_v0.prototype=new ConfigAdaptor.JB_json_v1();ConfigAdaptor.JB_json_v0.prototype.regularize_conf=function(b,a){b={tracks:b};dojo.forEach(b.tracks,function(c){if("url" in c){c.urlTemplate=c.url;delete c.url;c.backendVersion=0}});return ConfigAdaptor.JB_json_v1.prototype.regularize_conf.call(this,b,a)};ConfigAdaptor.JB_json_v0.prototype.parse_conf=function(conf_text){conf_text.replace(/^[^\{]+/,"");var conf;return eval("conf = "+conf_text)};var Util={};Util.is_ie=navigator.appVersion.indexOf("MSIE")>=0;Util.is_ie6=navigator.appVersion.indexOf("MSIE 6")>=0;Util.addCommas=function(e){e+="";var a=e.split(".");var d=a[0];var b=a.length>1?"."+a[1]:"";var c=/(\d+)(\d{3})/;while(c.test(d)){d=d.replace(c,"$1,$2")}return d+b};Util.wheel=function(a){var b=0;if(!a){a=window.event}if(a.wheelDelta){b=a.wheelDelta/120;if(window.opera){b=-b}}else{if(a.detail){b=-a.detail/3}}return Math.round(b)};Util.isRightButton=function(a){if(!a){var a=window.event}if(a.which){return a.which==3}else{if(a.button){return a.button==2}}};Util.getViewportWidth=function(){var a=0;if(document.documentElement&&document.documentElement.clientWidth){a=document.documentElement.clientWidth}else{if(document.body&&document.body.clientWidth){a=document.body.clientWidth}else{if(window.innerWidth){a=window.innerWidth-18}}}return a};Util.getViewportHeight=function(){var a=0;if(document.documentElement&&document.documentElement.clientHeight){a=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){a=document.body.clientHeight}else{if(window.innerHeight){a=window.innerHeight-18}}}return a};Util.findNearest=function(a,c){var b=0;var e=Math.abs(c-a[0]);for(var d=0;d<a.length;d++){if(Math.abs(c-a[d])<e){b=d;e=Math.abs(c-a[d])}}return b};Util.fillTemplate=function(b,a){return b.replace(/\{([^}]+)\}/g,function(c,d){if(a[d]!==undefined){return a[d]}else{return"{"+d+"}"}})};Util.maybeLoad=function(e,d,a,b){if(d.state){if("loaded"==d.state){a(d.data)}else{if("error"==d.state){b()}else{if("loading"==d.state){d.successCallbacks.push(a);if(b){d.errorCallbacks.push(b)}}}}}else{d.state="loading";d.successCallbacks=[a];d.errorCallbacks=[b];var c=dojo.clone(e);c.load=function(g){d.state="loaded";d.data=g;var f=d.successCallbacks;for(var h=0;h<f.length;h++){f[h](g)}};c.error=function(g){console.error(""+g);d.state="error";var f=d.errorCallbacks;for(var h=0;h<f.length;h++){f[h]()}};dojo.xhrGet(c)}};Util.deepUpdate=function(d,c){for(var e in c){if((e in d)&&("object"==typeof c[e])&&("object"==typeof d[e])){Util.deepUpdate(d[e],c[e])}else{if(typeof d[e]=="undefined"||typeof c[e]!=undefined){d[e]=c[e]}}}return d};Util.resolveUrl=function(b,a){if(a.match(/\w+:\/\//)){return a}if(a.charAt(0)=="/"){b=b.match(/.*\/\/[^\/]*/);return(b?b[0]:"")+a}b=b.substring(0,b.length-b.match(/[^\/]*$/)[0].length);if(a=="."){return b}while(a.substring(0,3)=="../"){b=b.substring(0,b.length-b.match(/[^\/]*\/$/)[0].length);a=a.substring(3)}return b+a};Util.parseLocString=function(a){a=dojo.trim(a);var c=a.match(/^(((\S*)\s*:)?\s*(-?[\d,.']+)\s*(\.\.|-|\s+))?\s*(-?[\d,.']+)$/i);if(!c){return null}var b=function(e){e=(e+"").replace(/\D/g,"");var d=parseInt(e,10);return typeof d=="number"&&!isNaN(d)?d:null};return{start:b(c[4])-1,end:b(c[6]),ref:c[3]}};Util.assembleLocString=function(c){var d="",b={start:"number",end:"number",ref:"string"},a={};for(var e in b){if(b[e]==typeof c[e]&&(b[e]!="number"||!isNaN(c[e]))){a[e]=c[e]}}if("ref" in a){d+=a.ref;if(a.start||a.end){d+=":"}}if("start" in a){d+=(Math.round(a.start)+1).toFixed(0).toLocaleString();if("end" in a){d+=".."}}if("end" in a){d+=Math.round(a.end).toFixed(0).toLocaleString()}return d};Util.matchRefSeqName=function(a,e){for(var c in e){if(!e.hasOwnProperty(c)){continue}var d=a.toUpperCase();var b=c.toUpperCase();if(d==b||"CHR"+d==b||d=="CHR"+b){return e[c]}}return null};Util.debugHandler=function(a,b){return function(){var c=arguments;window.setTimeout(function(){var d=b;if(typeof d=="string"){d=a[d]}d.apply(a,c)},1)}};Util.ucFirst=function(a){if(typeof a!="string"){return undefined}return a.charAt(0).toUpperCase()+a.slice(1)};Util.uniq=function(d,c){c=c||function(e){return""+e};var a=[],b={};dojo.forEach(d,function(e){var f=c(e);if(!b[c(e)]){a.push(e)}b[f]=true});return a};Util.crc32Table="00000000 77073096 EE0E612C 990951BA 076DC419 706AF48F E963A535 9E6495A3 0EDB8832 79DCB8A4 E0D5E91E 97D2D988 09B64C2B 7EB17CBD E7B82D07 90BF1D91 1DB71064 6AB020F2 F3B97148 84BE41DE 1ADAD47D 6DDDE4EB F4D4B551 83D385C7 136C9856 646BA8C0 FD62F97A 8A65C9EC 14015C4F 63066CD9 FA0F3D63 8D080DF5 3B6E20C8 4C69105E D56041E4 A2677172 3C03E4D1 4B04D447 D20D85FD A50AB56B 35B5A8FA 42B2986C DBBBC9D6 ACBCF940 32D86CE3 45DF5C75 DCD60DCF ABD13D59 26D930AC 51DE003A C8D75180 BFD06116 21B4F4B5 56B3C423 CFBA9599 B8BDA50F 2802B89E 5F058808 C60CD9B2 B10BE924 2F6F7C87 58684C11 C1611DAB B6662D3D 76DC4190 01DB7106 98D220BC EFD5102A 71B18589 06B6B51F 9FBFE4A5 E8B8D433 7807C9A2 0F00F934 9609A88E E10E9818 7F6A0DBB 086D3D2D 91646C97 E6635C01 6B6B51F4 1C6C6162 856530D8 F262004E 6C0695ED 1B01A57B 8208F4C1 F50FC457 65B0D9C6 12B7E950 8BBEB8EA FCB9887C 62DD1DDF 15DA2D49 8CD37CF3 FBD44C65 4DB26158 3AB551CE A3BC0074 D4BB30E2 4ADFA541 3DD895D7 A4D1C46D D3D6F4FB 4369E96A 346ED9FC AD678846 DA60B8D0 44042D73 33031DE5 AA0A4C5F DD0D7CC9 5005713C 270241AA BE0B1010 C90C2086 5768B525 206F85B3 B966D409 CE61E49F 5EDEF90E 29D9C998 B0D09822 C7D7A8B4 59B33D17 2EB40D81 B7BD5C3B C0BA6CAD EDB88320 9ABFB3B6 03B6E20C 74B1D29A EAD54739 9DD277AF 04DB2615 73DC1683 E3630B12 94643B84 0D6D6A3E 7A6A5AA8 E40ECF0B 9309FF9D 0A00AE27 7D079EB1 F00F9344 8708A3D2 1E01F268 6906C2FE F762575D 806567CB 196C3671 6E6B06E7 FED41B76 89D32BE0 10DA7A5A 67DD4ACC F9B9DF6F 8EBEEFF9 17B7BE43 60B08ED5 D6D6A3E8 A1D1937E 38D8C2C4 4FDFF252 D1BB67F1 A6BC5767 3FB506DD 48B2364B D80D2BDA AF0A1B4C 36034AF6 41047A60 DF60EFC3 A867DF55 316E8EEF 4669BE79 CB61B38C BC66831A 256FD2A0 5268E236 CC0C7795 BB0B4703 220216B9 5505262F C5BA3BBE B2BD0B28 2BB45A92 5CB36A04 C2D7FFA7 B5D0CF31 2CD99E8B 5BDEAE1D 9B64C2B0 EC63F226 756AA39C 026D930A 9C0906A9 EB0E363F 72076785 05005713 95BF4A82 E2B87A14 7BB12BAE 0CB61B38 92D28E9B E5D5BE0D 7CDCEFB7 0BDBDF21 86D3D2D4 F1D4E242 68DDB3F8 1FDA836E 81BE16CD F6B9265B 6FB077E1 18B74777 88085AE6 FF0F6A70 66063BCA 11010B5C 8F659EFF F862AE69 616BFFD3 166CCF45 A00AE278 D70DD2EE 4E048354 3903B3C2 A7672661 D06016F7 4969474D 3E6E77DB AED16A4A D9D65ADC 40DF0B66 37D83BF0 A9BCAE53 DEBB9EC5 47B2CF7F 30B5FFE9 BDBDF21C CABAC28A 53B39330 24B4A3A6 BAD03605 CDD70693 54DE5729 23D967BF B3667A2E C4614AB8 5D681B02 2A6F2B94 B40BBE37 C30C8EA1 5A05DF1B 2D02EF8D";Util.objectFingerprint=function(e){var d=0,a=0,g=0;var c=Util.crc32Table;var b=function(k){for(var h=0,j=k.length;h<j;h++){g=(d^k.charCodeAt(h))&255;a="0x"+c.substr(g*9,8);d=(d>>>8)^a}};if(typeof e=="object"){for(var f in e){b(""+Util.objectFingerprint(f));b(""+Util.objectFingerprint(e[f]))}}else{b(""+e)}return d};if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(a==0&&arguments.length==1){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.map){Array.prototype.map=function(b){if(this===void 0||this===null){throw new TypeError()}var f=Object(this);var a=f.length>>>0;if(typeof b!=="function"){throw new TypeError()}var e=new Array(a);var d=arguments[1];for(var c=0;c<a;c++){if(c in f){e[c]=b.call(d,f[c],c,f)}}return e}}if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c){if(this===void 0||this===null){throw new TypeError()}var d=Object(this);var a=d.length>>>0;if(a===0){return -1}var e=0;if(arguments.length>0){e=Number(arguments[1]);if(e!==e){e=0}else{if(e!==0&&e!==(1/0)&&e!==-(1/0)){e=(e>0||-1)*Math.floor(Math.abs(e))}}}if(e>=a){return -1}var b=e>=0?e:Math.max(a-Math.abs(e),0);for(;b<a;b++){if(b in d&&d[b]===c){return b}}return -1}}function Finisher(a){this.fun=a;this.count=0}Finisher.prototype.inc=function(){this.count++};Finisher.prototype.dec=function(){this.count--;this.finish()};Finisher.prototype.finish=function(){if(this.count<=0){this.fun()}};function ArrayRepr(b){this.classes=b;this.fields=[];for(var a=0;a<b.length;a++){this.fields[a]={};for(var c=0;c<b[a].attributes.length;c++){this.fields[a][b[a].attributes[c]]=c+1}if(b[a].proto===undefined){b[a].proto={}}if(b[a].isArrayAttr===undefined){b[a].isArrayAttr={}}}}ArrayRepr.prototype.attrIndices=function(a){return this.classes.map(function(b){var c=b.attributes.indexOf(a);return c>=0?c+1:undefined})};ArrayRepr.prototype.get=function(b,a){if(a in this.fields[b[0]]){return b[this.fields[b[0]][a]]}else{var c=this.classes[b[0]].attributes.length+1;if((c>=b.length)||(!(a in b[c]))){if(a in this.classes[b[0]].proto){return this.classes[b[0]].proto[a]}return undefined}return b[c][a]}};ArrayRepr.prototype.set=function(b,a,c){if(a in this.fields[b[0]]){b[this.fields[b[0]][a]]=c}else{var d=self.classes[b[0]].length+1;if(d>=b.length){b[d]={}}b[d][a]=c}};ArrayRepr.prototype.makeSetter=function(a){var b=this;return function(c,d){b.set(c,a,d)}};ArrayRepr.prototype.makeGetter=function(a){var b=this;return function(c){return b.get(c,a)}};ArrayRepr.prototype.makeFastSetter=function(a){var b=this.attrIndices(a);return function(c,d){if(b[c[0]]!==undefined){c[b[c[0]]]=d}}};ArrayRepr.prototype.makeFastGetter=function(a){var b=this.attrIndices(a);return function(c){if(b[c[0]]!==undefined){return c[b[c[0]]]}else{return undefined}}};ArrayRepr.prototype.construct=function(d,e,c){var b=new Array(d.classes[c].length);for(var a in e){this.set(b,a,e[a])}return b};ArrayRepr.prototype.accessors=function(){return this._accessors=this._accessors||this._makeAccessors()};ArrayRepr.prototype._makeAccessors=function(){var b=this,a={get:function(g){var e=this.get.field_accessors[g];if(e){return e.call(this)}else{return undefined}},set:function(g,h){var e=this.set.field_accessors[g];if(e){return e.call(this,h)}else{return undefined}}};a.get.field_accessors={};a.set.field_accessors={};var d={};dojo.forEach(this.classes,function(f,e){dojo.forEach(f.attributes||[],function(g,h){g=g.toLowerCase();d[g]=d[g]||[];d[g][e]=h+1})});for(var c in d){if(!d.hasOwnProperty(c)){continue}a.get.field_accessors[c]=(function(){var e=d[c];return !e?function(){return undefined}:function(){return this[e[this[0]]]}})();a.set.field_accessors[c]=(function(){var e=d[c];return !e?function(){return undefined}:function(f){return(this[e[this[0]]]=f)}})()}return a};function NCList(){}NCList.prototype.importExisting=function(e,a,d,b,c){this.topList=e;this.attrs=a;this.start=a.makeFastGetter("Start");this.end=a.makeFastGetter("End");this.lazyClass=c;this.baseURL=d;this.lazyUrlTemplate=b;this.lazyChunks={}};NCList.prototype.fill=function(e,m){this.attrs=m;this.start=m.makeFastGetter("Start");this.end=m.makeFastGetter("End");var f=m.makeSetter("Sublist");var a=this.start;var c=this.end;var k=e;k.sort(function(o,n){if(a(o)!=a(n)){return a(o)-a(n())}else{return c(n)-c(o)}});var l=new Array();var j=new Array();this.topList=j;j.push(k[0]);var b,g;for(var d=1,h=k.length;d<h;d++){b=k[d];if(c(b)<c(k[d-1])){l.push(j);j=new Array(b);f(k[d-1],j)}else{while(true){if(0==l.length){j.push(b);break}else{g=l[l.length-1];if(c(g[g.length-1])>c(b)){j.push(b);break}else{j=l.pop()}}}}}};NCList.prototype.binarySearch=function(c,e,b){var a=-1;var f=c.length;var d;while(f-a>1){d=(a+f)>>>1;if(b(c[d])>e){f=d}else{a=d}}if(b===this.end){return f}else{return a}};NCList.prototype.iterHelper=function(g,o,p,k,n,b,j,q,r){var h=g.length;var d=this.binarySearch(g,o,j);var c=this.attrs.makeGetter("Chunk");var a=this.attrs.makeGetter("Sublist");while((d<h)&&(d>=0)&&((b*q(g[d]))<(b*p))){if(g[d][0]==this.lazyClass){var m=this;var f=c(g[d]);if(!(f in this.lazyChunks)){this.lazyChunks[f]={}}var l=this.lazyChunks[f];n.inc();Util.maybeLoad({url:Util.resolveUrl(this.baseURL,this.lazyUrlTemplate.replace(/\{Chunk\}/g,f)),handleAs:"json"},l,(function(s){return function(t){m.iterHelper(t,o,p,k,n,b,j,q,[s]);n.dec()}})(f),function(){n.dec()})}else{k(g[d],r.concat(d))}var e=a(g[d]);if(e){this.iterHelper(e,o,p,k,n,b,j,q,r.concat(d))}d+=b}};NCList.prototype.iterate=function(h,g,a,d){var e=(h>g)?-1:1;var c=(h>g)?this.start:this.end;var f=(h>g)?this.end:this.start;var b=new Finisher(d);this.iterHelper(this.topList,h,g,a,b,e,c,f,[0]);b.finish()};NCList.prototype.histogram=function(f,g,e,h){var j=new Array(e);var a=(g-f)/e;var b=this.start;var c=this.end;for(var d=0;d<e;d++){j[d]=0}this.iterate(f,g,function(n){var m=Math.max(0,((b(n)-f)/a)|0);var k=Math.min(e,((c(n)-f)/a)|0);for(var l=m;l<=k;l++){j[l]++}},function(){h(j)})};function NCList_v0(){}NCList_v0.prototype.importExisting=function(e,c,a,d,b){this.topList=e;this.sublistIndex=c;this.lazyIndex=a;this.baseURL=d;this.lazyUrlTemplate=b};NCList_v0.prototype.fill=function(c,g){this.sublistIndex=g;var h=c;h.sort(function(l,k){if(l[0]!=k[0]){return l[0]-k[0]}else{return k[1]-l[1]}});var j=new Array();var f=new Array();this.topList=f;f.push(h[0]);var a,d;for(var b=1,e=h.length;b<e;b++){a=h[b];if(a[1]<h[b-1][1]){j.push(f);f=new Array(a);h[b-1][g]=f}else{while(true){if(0==j.length){f.push(a);break}else{d=j[j.length-1];if(d[d.length-1][1]>a[1]){f.push(a);break}else{f=j.pop()}}}}}};NCList_v0.prototype.binarySearch=function(b,e,d){var a=-1;var f=b.length;var c;while(f-a>1){c=(a+f)>>>1;if(b[c][d]>e){f=c}else{a=c}}if(1==d){return f}else{return a}};NCList_v0.prototype.iterHelper=function(d,k,l,f,h,a,j,b,m){var e=d.length;var c=this.binarySearch(d,k,j);while((c<e)&&(c>=0)&&((a*d[c][b])<(a*l))){if("object"==typeof d[c][this.lazyIndex]){var g=this;if(d[c][this.lazyIndex].state){if("loading"==d[c][this.lazyIndex].state){h.inc();d[c][this.lazyIndex].callbacks.push(function(n){return function(p){g.iterHelper(p,k,l,f,h,a,j,b,m.concat(n));h.dec()}}(c))}else{if("loaded"==d[c][this.lazyIndex].state){}else{console.log("unknown lazy type: "+d[c])}}}else{d[c][this.lazyIndex].state="loading";d[c][this.lazyIndex].callbacks=[];h.inc();dojo.xhrGet({url:Util.resolveUrl(this.baseURL,this.lazyUrlTemplate.replace(/\{chunk\}/g,d[c][this.lazyIndex].chunk)),handleAs:"json",load:function(p,q,o,n){return function(r){q.state="loaded";p[o]=r;g.iterHelper(r,k,l,f,h,a,j,b,m.concat(n));for(var s=0;s<q.callbacks.length;s++){q.callbacks[s](r)}h.dec()}}(d[c],d[c][this.lazyIndex],this.sublistIndex,c),error:function(){h.dec()}})}}else{f(d[c],m.concat(c))}if(d[c][this.sublistIndex]){this.iterHelper(d[c][this.sublistIndex],k,l,f,h,a,j,b,m.concat(c))}c+=a}};NCList_v0.prototype.iterate=function(h,g,a,e){var f=(h>g)?-1:1;var b=(h>g)?0:1;var d=(h>g)?1:0;var c=new Finisher(e);this.iterHelper(this.topList,h,g,a,c,f,b,d,[]);c.finish()};NCList_v0.prototype.histogram=function(g,f,c,e){var a=new Array(c);var d=(f-g)/c;for(var b=0;b<c;b++){a[b]=0}this.iterate(g,f,function(l){var k=Math.max(0,((l[0]-g)/d)|0);var h=Math.min(c,((l[1]-g)/d)|0);for(var j=k;j<=h;j++){a[j]++}},function(){e(a)})};function LazyTrie(a,c){this.rootURL=a;this.chunkTempl=c;var b=this;dojo.xhrGet({url:a,handleAs:"json",load:function(d){if(!d){console.log("failed to load trie");return}b.root=d;b.extra=d[0];if(b.deferred){b.deferred.callee.apply(b,b.deferred);delete b.deferred}}})}LazyTrie.prototype.chunkUrl=function(b){var a=this.chunkTempl.replace("{Chunk}",b);return Util.resolveUrl(this.rootURL,a)};LazyTrie.prototype.pathToPrefix=function(d){var c=this.root;var a="";loop:for(var b=0;b<d.length;b++){switch(typeof c[d[b]][0]){case"string":a+=c[d[b]][0];break;case"number":a+=c[d[b]][1];break loop}c=c[d[b]]}return a};LazyTrie.prototype.valuesFromPrefix=function(a,c){var b=this;this.findNode(a,function(e,d){c(b.valuesFromNode(d))})};LazyTrie.prototype.mappingsFromPrefix=function(a,c){var b=this;this.findNode(a,function(e,d){c(b.mappingsFromNode(e,d))})};LazyTrie.prototype.mappingsFromNode=function(d,c){var b=[];if(c[1]!==null){b.push([d,c[1]])}for(var a=2;a<c.length;a++){if("string"==typeof c[a][0]){b=b.concat(this.mappingsFromNode(d+c[a][0],c[a]))}}return b};LazyTrie.prototype.valuesFromNode=function(c){var b=[];if(c[1]!==null){b.push(c[1])}for(var a=2;a<c.length;a++){b=b.concat(this.valuesFromNode(c[a]))}return b};LazyTrie.prototype.exactMatch=function(a,c){var b=this;this.findNode(a,function(e,d){if((e.toLowerCase()==a.toLowerCase())&&d[1]){c(d[1])}})};LazyTrie.prototype.findNode=function(a,c){var b=this;this.findPath(a,function(f){var e=b.root;for(i=0;i<f.length;i++){e=e[f[i]]}var d=b.pathToPrefix(f);c(d,e)})};LazyTrie.prototype.findPath=function(c,g){if(!this.root){this.deferred=arguments;return}c=c.toLowerCase();var b=this.root;var a=0;var f;var e=[];while(true){f=this.binarySearch(b,c.charAt(a));if(f<0){return}e.push(f);if("number"==typeof b[f][0]){var d=this;dojo.xhrGet({url:this.chunkUrl(this.pathToPrefix(e)),handleAs:"json",load:function(h){b[f]=h;d.findPath(c,g)}});return}b=b[f];if(c.substr(a,b[0].length)!=b[0].substr(0,Math.min(b[0].length,c.length-a))){return}a+=b[0].length;if(a>=c.length){g(e);return}}};LazyTrie.prototype.binarySearch=function(c,e){var b=2;var f=c.length-1;var d,g;while(b<=f){d=(b+f)>>>1;switch(typeof c[d][0]){case"string":g=c[d][0].charAt(0);break;case"number":g=c[d][1].charAt(0);break}if(g<e){b=d+1}else{if(g>e){f=d-1}else{return d}}}return -(b+1)};function LazyArray(b,a){this.urlTemplate=b.urlTemplate;this.chunkSize=b.chunkSize;this.length=b.length;this.baseUrl=(a===undefined?"":a);this.chunks=[];this.toProcess={}}LazyArray.prototype.index=function(a,c,b){this.range(a,a,c,undefined,b)};LazyArray.prototype.range=function(b,h,m,d,e){b=Math.max(0,b);h=Math.min(h,this.length-1);var f=Math.floor(b/this.chunkSize);var j=Math.floor(h/this.chunkSize);if(d===undefined){d=function(){}}var l=new Finisher(d);for(var k=f;k<=j;k++){if(this.chunks[k]){this._processChunk(b,h,k,m,e)}else{var g={start:b,end:h,callback:m,param:e,finish:l};l.inc();if(this.toProcess[k]){this.toProcess[k].push(g)}else{this.toProcess[k]=[g];var a=this.urlTemplate.replace(/\{Chunk\}/g,k);var c=this;dojo.xhrGet({url:Util.resolveUrl(this.baseUrl,a),handleAs:"json",load:this._makeLoadFun(k),error:function(){l.dec()}})}}}l.finish()};LazyArray.prototype._makeLoadFun=function(a){var b=this;return function(e){b.chunks[a]=e;var d=b.toProcess[a];delete b.toProcess[a];for(var c=0;c<d.length;c++){b._processChunk(d[c].start,d[c].end,a,d[c].callback,d[c].param);d[c].finish.dec()}}};LazyArray.prototype._processChunk=function(b,f,h,j,d){var a=h*this.chunkSize;var c=b-a;var e=f-a;c=Math.max(0,c);e=Math.min(e,this.chunkSize-1);for(var g=c;g<=e;g++){j(g+a,this.chunks[h][g],d)}};function Track(b,d,a,c){this.name=b;this.key=d;this.loaded=a;this.changed=c||function(){};this.height=0;this.shown=true;this.empty=false}Track.prototype.load=function(a){dojo.xhrGet({url:a,handleAs:"json",failOk:true,load:dojo.hitch(this,function(b){this.loadSuccess(b,a)}),error:dojo.hitch(this,function(b){this.loadFail(b,a)})})};Track.prototype.loadSuccess=function(a){this.setLoaded()};Track.prototype.loadFail=function(a){if(a.status!=404){console.error(""+a)}this.empty=true;this.setLoaded()};Track.prototype.heightUpdate=function(a,b){if(!this.shown){this.heightUpdateCallback(0);return}if(b!==undefined){this.blockHeights[b]=a}this.height=Math.max(this.height,a);if(!this.inShowRange){this.heightUpdateCallback(Math.max(this.labelHeight,this.height))}};Track.prototype.setViewInfo=function(g,f,a,c,b,e,d){this.heightUpdateCallback=g;this.div=a;this.label=c;this.widthPct=b;this.widthPx=e;this.leftBlank=document.createElement("div");this.leftBlank.className="blank-block";this.rightBlank=document.createElement("div");this.rightBlank.className="blank-block";this.div.appendChild(this.rightBlank);this.div.appendChild(this.leftBlank);this.sizeInit(f,b);this.labelHTML="";this.labelHeight=0};Track.prototype.hide=function(){if(this.shown){this.div.style.display="none";this.shown=false}};Track.prototype.show=function(){if(!this.shown){this.div.style.display="block";this.shown=true}};Track.prototype.initBlocks=function(){this.blocks=new Array(this.numBlocks);this.blockHeights=new Array(this.numBlocks);for(var a=0;a<this.numBlocks;a++){this.blockHeights[a]=0}this.firstAttached=null;this.lastAttached=null;this._adjustBlanks()};Track.prototype.clear=function(){if(this.blocks){for(var a=0;a<this.numBlocks;a++){this._hideBlock(a)}}this.initBlocks()};Track.prototype.setLabel=function(a){if(this.label===undefined||this.labelHTML==a){return}this.labelHTML=a;dojo.query(".track-label-text",this.label).forEach(function(b){b.innerHTML=a});this.labelHeight=this.label.offsetHeight};Track.prototype.transfer=function(){};Track.prototype.startZoom=function(b,c,a){};Track.prototype.endZoom=function(b,a){};Track.prototype.showRange=function(g,l,a,c,d,j,n){if(this.blocks===undefined){return 0}if((this.labelHeight==0)&&this.label){this.labelHeight=this.label.offsetHeight}this.inShowRange=true;this.height=this.labelHeight;var h=(null==this.firstAttached?l+1:this.firstAttached);var e=(null==this.lastAttached?g-1:this.lastAttached);var f,m;var k=0;for(f=e;f>=g;f--){m=a+(c*(f-g));this._showBlock(f,m,m+c,d,j,n)}for(f=e+1;f<=l;f++){m=a+(c*(f-g));this._showBlock(f,m,m+c,d,j,n)}var b=this.blocks[g];for(f=h;f<g;f++){this.transfer(this.blocks[f],b,d,j,n);this.cleanupBlock(this.blocks[f]);this._hideBlock(f)}b=this.blocks[l];for(f=e;f>l;f--){this.transfer(this.blocks[f],b,d,j,n);this.cleanupBlock(this.blocks[f]);this._hideBlock(f)}this.firstAttached=g;this.lastAttached=l;this._adjustBlanks();this.inShowRange=false;this.heightUpdate(this.height);return 1};Track.prototype.cleanupBlock=function(){};Track.prototype._hideBlock=function(a){if(this.blocks[a]){this.div.removeChild(this.blocks[a]);this.blocks[a]=undefined;this.blockHeights[a]=0}};Track.prototype._adjustBlanks=function(){if((this.firstAttached===null)||(this.lastAttached===null)){this.leftBlank.style.left="0px";this.leftBlank.style.width="50%";this.rightBlank.style.left="50%";this.rightBlank.style.width="50%"}else{this.leftBlank.style.width=(this.firstAttached*this.widthPct)+"%";this.rightBlank.style.left=((this.lastAttached+1)*this.widthPct)+"%";this.rightBlank.style.width=((this.numBlocks-this.lastAttached-1)*this.widthPct)+"%"}};Track.prototype.hideAll=function(){if(null==this.firstAttached){return}for(var a=this.firstAttached;a<=this.lastAttached;a++){this._hideBlock(a)}this.firstAttached=null;this.lastAttached=null;this._adjustBlanks()};Track.prototype.setLoaded=function(){this.loaded=true;this.hideAll();this.changed()};Track.prototype._loadingBlock=function(a){a.appendChild(document.createTextNode("Loading..."));a.style.backgroundColor="#eee";return 50};Track.prototype._showBlock=function(e,d,c,g,b,a){if(this.blocks[e]){this.heightUpdate(this.blockHeights[e],e);return}if(this.empty){this.heightUpdate(this.labelHeight,e);return}var f=document.createElement("div");f.className="block";f.style.left=(e*this.widthPct)+"%";f.style.width=this.widthPct+"%";f.startBase=d;f.endBase=c;if(this.loaded){this.fillBlock(e,f,this.blocks[e-1],this.blocks[e+1],d,c,g,this.widthPx,b,a)}else{this._loadingBlock(f)}this.blocks[e]=f;this.div.appendChild(f)};Track.prototype.moveBlocks=function(f){var e=new Array(this.numBlocks);var a=new Array(this.numBlocks);var c;for(c=0;c<this.numBlocks;c++){a[c]=0}var d;if((this.lastAttached+f<0)||(this.firstAttached+f>=this.numBlocks)){this.firstAttached=null;this.lastAttached=null}else{this.firstAttached=Math.max(0,Math.min(this.numBlocks-1,this.firstAttached+f));this.lastAttached=Math.max(0,Math.min(this.numBlocks-1,this.lastAttached+f));if(f<0){d=this.blocks[this.firstAttached-f]}else{d=this.blocks[this.lastAttached-f]}}for(c=0;c<this.blocks.length;c++){var b=c+f;if((b<0)||(b>=this.numBlocks)){if(d&&this.blocks[c]){this.transfer(this.blocks[c],d)}this._hideBlock(c)}else{e[b]=this.blocks[c];if(e[b]){e[b].style.left=((b)*this.widthPct)+"%"}a[b]=this.blockHeights[c]}}this.blocks=e;this.blockHeights=a;this._adjustBlanks()};Track.prototype.sizeInit=function(f,b,a){var c,d;this.numBlocks=f;this.widthPct=b;if(a){this.moveBlocks(-a)}if(this.blocks&&(this.blocks.length>0)){var e=this.blocks[f-1];for(c=f;c<this.blocks.length;c++){if(e&&this.blocks[c]){this.transfer(this.blocks[c],e)}this._hideBlock(c)}d=this.blocks.length;this.blocks.length=f;this.blockHeights.length=f;for(c=d;c<f;c++){this.blocks[c]=undefined;this.blockHeights[c]=0}this.lastAttached=Math.min(this.lastAttached,f-1);if(this.firstAttached>this.lastAttached){this.firstAttached=null;this.lastAttached=null}if(this.blocks.length!=f){throw new Error("block number mismatch: should be "+f+"; blocks.length: "+this.blocks.length)}for(c=0;c<f;c++){if(this.blocks[c]){this.blocks[c].style.left=(c*b)+"%";this.blocks[c].style.width=b+"%"}}}else{this.initBlocks()}};Track.prototype.updateStaticElements=function(a){this.window_info=dojo.mixin(this.window_info||{},a)};function SequenceTrack(a,c,b){Track.call(this,a.label,a.key,false,b.changeCallback);this.config=a;this.charWidth=b.charWidth;this.seqHeight=b.seqHeight;this.refSeq=c;this.sequenceStore=new SequenceStore.StaticChunked({baseUrl:a.baseUrl,urlTemplate:a.urlTemplate,compress:a.compress})}SequenceTrack.prototype=new Track("");SequenceTrack.prototype.load=function(){window.setTimeout(dojo.hitch(this,"setLoaded"),10)};SequenceTrack.prototype.startZoom=function(b,c,a){this.hide();this.heightUpdate(0)};SequenceTrack.prototype.endZoom=function(b,a){if(b==this.charWidth){this.show()}Track.prototype.clear.apply(this)};SequenceTrack.prototype.setViewInfo=function(c,g,a,d,b,f,e){Track.prototype.setViewInfo.apply(this,[c,g,a,d,b,f,e]);if(e==this.charWidth){this.show()}else{this.hide();this.heightUpdate(0)}this.setLabel(this.key)};SequenceTrack.nbsp=String.fromCharCode(160);SequenceTrack.prototype.fillBlock=function(h,b,d,j,l,e,a,g,f,k){var c=this;if(a==this.charWidth){this.show()}else{this.hide();this.heightUpdate(0)}if(this.shown){this.sequenceStore.getRange(this.refSeq,l,e,function(q,m,o){for(;q<0;q++){o=SequenceTrack.nbsp+o}var p=document.createElement("div");p.className="sequence";b.appendChild(p);p.appendChild(c.renderSeqDiv(q,m,o));var n=c.renderSeqDiv(q,m,c.complement(o));n.className="revcom";p.appendChild(n)});this.heightUpdate(this.seqHeight,h)}else{this.heightUpdate(0,h)}};SequenceTrack.prototype.complement=(function(){var b=/[ACGT]/gi;var c={S:"S",w:"w",T:"A",r:"y",a:"t",N:"N",K:"M",x:"x",d:"h",Y:"R",V:"B",y:"r",M:"K",h:"d",k:"m",C:"G",g:"c",t:"a",A:"T",n:"n",W:"W",X:"X",m:"k",v:"b",B:"V",s:"s",H:"D",c:"g",D:"H",b:"v",R:"Y",G:"C"};var a=function(d){return c[d]||SequenceTrack.nbsp};return function(d){return d.replace(b,a)}})();SequenceTrack.prototype.renderSeqDiv=function(d,b,c){var a=document.createElement("div");a.appendChild(document.createTextNode(c));return a};function Contour(a){if(a===undefined){a=0}this.spans=[{top:a,x:Infinity,height:0}]}Contour.prototype.getFit=function(c,b,g){var f,d;var a=0;if(g){for(;this.spans[a].top<g;a++){if(a>=(this.spans.length-1)){return{above:this.spans.length-1,count:0}}}}ABOVE:for(;a<this.spans.length;a++){f=this.spans[a].top+this.spans[a].height;for(var e=1;a+e<this.spans.length;e++){d=this.spans[a+e];if((f+b)<=d.top){return{above:a,count:e-1}}if(d.x>c){continue ABOVE}if((d.x<=c)&&((f+b)<(d.top+d.height))){return{above:a,count:e-1}}}return{above:a,count:e-1}}return{above:a,count:0}};Contour.prototype.insertFit=function(d,c,e,b){var a=this.spans[d.above];if((Math.abs(a.x-c)<1)&&(Math.abs((a.top+a.height)-e)<1)){a.height=(e+b)-a.top;a.x=Math.max(a.x,c);this.spans.splice(d.above+1,d.count)}else{this.spans.splice(d.above+1,d.count,{top:e,x:c,height:b})}};Contour.prototype.unionWith=function(j,g,l){var b,k,e,h,c;var a=g+l;START:for(k=0;k<this.spans.length;k++){h=this.spans[k];b=h.top+h.height;if(h.top>g){e=k;break START}if(b>g){if(h.x>=j){var d=b-g;g+=d;l-=d;if(g>=a){return}continue}else{for(e=k;e<this.spans.length;e++){c=this.spans[e];if(((c.top+c.height)>a)||c.x>j){break START}}break START}}}var f=this.spans[k-1];if((Math.abs(f.x-j)<1)&&(Math.abs((f.top+f.height)-g)<1)){f.height=(g+l)-f.top;f.x=Math.max(f.x,j);this.spans.splice(k,e-k)}else{this.spans.splice(k,e-k,{top:g,x:j,height:l})}};Contour.prototype.getNextTop=function(a){return this.spans[a.above].top+this.spans[a.above].height};function Layout(a,b){this.leftBound=a;this.rightBound=b;this.leftContour=new Contour();this.rightContour=new Contour();this.seen={};this.leftOverlaps=[];this.rightOverlaps=[];this.totalHeight=0}Layout.prototype.addRect=function(h,f,c,b){if(this.seen[h]!==undefined){return this.seen[h]}var g=this.tryLeftFit(f,c,b,0);var a=this.tryRightFit(f,c,b,0);var e;if(g.top<a.top){e=g.top;this.leftContour.insertFit(g.fit,this.rightBound-f,e,b);this.rightContour.unionWith(c-this.leftBound,e,b)}else{e=a.top;this.rightContour.insertFit(a.fit,c-this.leftBound,e,b);this.leftContour.unionWith(this.rightBound-f,e,b)}var d={id:h,left:f,right:c,top:e,height:b};this.seen[h]=e;if(f<=this.leftBound){this.leftOverlaps.push(d);if(this.leftLayout){this.leftLayout.addExisting(d)}}if(c>=this.rightBound){this.rightOverlaps.push(d);if(this.rightLayout){this.rightLayout.addExisting(d)}}this.seen[h]=e;this.totalHeight=Math.max(this.totalHeight,e+b);return e};Layout.prototype.tryLeftFit=function(g,e,b,f){var d,a;var c=f;while(true){d=this.leftContour.getFit(this.rightBound-e,b,c);c=Math.max(this.leftContour.getNextTop(d),c);if(this.rightLayout&&(e>=this.rightBound)){a=this.rightLayout.tryLeftFit(g,e,b,c);if(a.top>c){c=a.top;continue}}break}return{top:c,fit:d}};Layout.prototype.tryRightFit=function(g,e,b,f){var d,a;var c=f;while(true){d=this.rightContour.getFit(g-this.leftBound,b,c);c=Math.max(this.rightContour.getNextTop(d),c);if(this.leftLayout&&(g<=this.leftBound)){a=this.leftLayout.tryRightFit(g,e,b,c);if(a.top>c){c=a.top;continue}}break}return{top:c,fit:d}};Layout.prototype.hasSeen=function(a){return(this.seen[a]!==undefined)};Layout.prototype.setLeftLayout=function(b){for(var a=0;a<this.leftOverlaps.length;a++){b.addExisting(this.leftOverlaps[a])}this.leftLayout=b};Layout.prototype.setRightLayout=function(b){for(var a=0;a<this.rightOverlaps.length;a++){b.addExisting(this.rightOverlaps[a])}this.rightLayout=b};Layout.prototype.cleanup=function(){this.leftLayout=undefined;this.rightLayout=undefined};Layout.prototype.addExisting=function(a){if(this.seen[a.id]!==undefined){return}this.seen[a.id]=a.top;this.totalHeight=Math.max(this.totalHeight,a.top+a.height);if(a.left<=this.leftBound){this.leftOverlaps.push(a);if(this.leftLayout){this.leftLayout.addExisting(a)}}if(a.right>=this.rightBound){this.rightOverlaps.push(a);if(this.rightLayout){this.rightLayout.addExisting(a)}}this.leftContour.unionWith(this.rightBound-a.left,a.top,a.height);this.rightContour.unionWith(a.right-this.leftBound,a.top,a.height)};function Store(a){}Store.prototype.loadSuccess=function(b,a){};Store.prototype.loadFail=function(a){this.empty=true;this.setLoaded()};Store.prototype.load=function(a){dojo.xhrGet({url:a||this.url,handleAs:"json",failOk:true,load:dojo.hitch(this,function(b){this.loadSuccess(b,a)}),error:dojo.hitch(this,function(b){this.loadFail(b,a)})})};Store.prototype.setLoaded=function(){this.loaded=true;this.hideAll();this.changed()};Store.prototype.hideAll=function(){};Store.prototype.changed=function(){};function SeqFeatureStore(a){Store.call(this,a);if(!a){return}this.loaded=a.loaded;this.changed=a.changeCallback||function(){}}SeqFeatureStore.prototype=new Store("");var SeqFeatureStore;if(!SeqFeatureStore){SeqFeatureStore=function(){}}SeqFeatureStore.NCList=function(a){SeqFeatureStore.call(this,a);if(!a){return}this.nclist=this.makeNCList();this.baseUrl=a.baseUrl;this.urlTemplates={tracklist:a.urlTemplate};this.refSeq=a.refSeq};SeqFeatureStore.NCList.prototype=new SeqFeatureStore();SeqFeatureStore.NCList.prototype.makeNCList=function(){return new NCList()};SeqFeatureStore.NCList.prototype.load=function(){var a=Util.resolveUrl(this.baseUrl,Util.fillTemplate(this.urlTemplates.tracklist,{refseq:this.refSeq.name}));dojo.xhrGet({url:a,handleAs:"json",failOk:true,load:Util.debugHandler(this,function(b){this.loadSuccess(b,a)}),error:dojo.hitch(this,function(b){if(b.status!=404){console.error(""+b)}this.loadFail(b,a)})})};SeqFeatureStore.NCList.prototype.loadSuccess=function(c,a){this.count=c.featureCount;this.density=c.featureCount/this.refSeq.length;this.loadNCList(c,a);if(c.histograms&&c.histograms.meta){this.histograms=c.histograms;for(var b=0;b<this.histograms.meta.length;b++){this.histograms.meta[b].lazyArray=new LazyArray(this.histograms.meta[b].arrayParams,a)}}};SeqFeatureStore.NCList.prototype.loadNCList=function(b,a){this.attrs=new ArrayRepr(b.intervals.classes);this.nclist.importExisting(b.intervals.nclist,this.attrs,a,b.intervals.urlTemplate,b.intervals.lazyClass)};SeqFeatureStore.NCList.prototype.loadFail=function(b,a){this.empty=true;this.setLoaded()};SeqFeatureStore.NCList.prototype.histogram=function(){return this.nclist.histogram.apply(this.nclist,arguments)};SeqFeatureStore.NCList.prototype.iterate=function(e,c,b,a){var f=this;var d=this.attrs.accessors(),g=function(h,j){f._add_getters(d.get,h);return b(h,j)};return this.nclist.iterate.call(this.nclist,e,c,g,a)};SeqFeatureStore.NCList.prototype._add_getters=function(a,b){var c=this;b.get=a;dojo.forEach(b.get("subfeatures"),function(d){c._add_getters(a,d)})};var SeqFeatureStore;if(!SeqFeatureStore){SeqFeatureStore=function(){}}SeqFeatureStore.NCList_v0=function(a){SeqFeatureStore.NCList.call(this,a);this.fields={};this.track=a.track};SeqFeatureStore.NCList_v0.prototype=new SeqFeatureStore.NCList("");SeqFeatureStore.NCList_v0.prototype._del=function(c,b){var a=c[b];delete c[b];return a};SeqFeatureStore.NCList_v0.prototype.loadSuccess=function(d,a){if(d){dojo.forEach(d.histogramMeta,function(e){e.arrayParams.urlTemplate=e.arrayParams.urlTemplate.replace(/\{chunk\}/,"{Chunk}")});d.histograms={meta:this._del(d,"histogramMeta"),stats:this._del(d,"histStats")};dojo.forEach(d.histograms.stats,function(e){e.basesPerBin=this._del(e,"bases")},this);var c={urlTemplate:"linkTemplate"};dojo.forEach(["className","arrowheadClass","subfeatureClasses","urlTemplate","clientConfig"],function(f){if(!this.track.config.style){this.track.config.style={}}var e=c[f]||f;if(f in d){this.track.config.style[e]=d[f]}},this);if(this.track.config.style.clientConfig){this.track.config.style=dojo.mixin(this.track.config.style,this.track.config.style.clientConfig);delete this.track.config.style.clientConfig}this.fields={};var b;for(b=0;b<d.headers.length;b++){this.fields[d.headers[b]]=b}this.subFields={};if(d.subfeatureHeaders){for(b=0;b<d.subfeatureHeaders.length;b++){this.subFields[d.subfeatureHeaders[b]]=b}}}return SeqFeatureStore.NCList.prototype.loadSuccess.call(this,d,a)};SeqFeatureStore.NCList_v0.prototype.makeNCList=function(){return new NCList_v0()};SeqFeatureStore.NCList_v0.prototype.loadNCList=function(b,a){this.nclist.importExisting(b.featureNCList,b.sublistIndex,b.lazyIndex,a,b.lazyfeatureUrlTemplate)};SeqFeatureStore.NCList_v0.prototype.iterate=function(a,d,j,k){var g=this,f=this.fields,e=this.subFields,c=function(l){var m=f[l];if(m>=0){return this[m]}else{return undefined}},h=function(l){var m=e[l];if(m>=0){return this[m]}else{return undefined}},b=function(l,m){l.get=c;dojo.forEach(l.get("subfeatures"),function(n){n.get=h});return j(l,m)};return this.nclist.iterate.call(this.nclist,a,d,b,k)};var TiledImageStore;if(!TiledImageStore){TiledImageStore={}}TiledImageStore.Fixed=function(a){Store.call(this,a);if(!a){return}this.tileToImage={};this.zoomCache={};this.refSeq=a.refSeq;this.url=Util.resolveUrl(a.baseUrl,Util.fillTemplate(a.urlTemplate,{refseq:this.refSeq.name}))};TiledImageStore.Fixed.prototype=new Store("");TiledImageStore.Fixed.prototype.loadSuccess=function(a){this.stats=a.stats;this.tileWidth=a.tileWidth;this.align=a.align;this.zoomLevels=a.zoomLevels;this.setLoaded()};TiledImageStore.Fixed.prototype._getZoom=function(d){var a=this.zoomCache[d];if(a){return a}a=this.zoomLevels[0];var c=this.tileWidth/d;for(var b=1;b<this.zoomLevels.length;b++){if(Math.abs(this.zoomLevels[b].basesPerTile-c)<Math.abs(a.basesPerTile-c)){a=this.zoomLevels[b]}}this.zoomCache[d]=a;return a};TiledImageStore.Fixed.prototype.getImages=function(b,a,c){var h=this._getZoom(b);var e=Math.max(a/h.basesPerTile,0)|0;var g=c/h.basesPerTile|0;var j=[];var f;for(var d=e;d<=g;d++){f=this.tileToImage[d];if(!f){f=document.createElement("img");dojo.connect(f,"onerror",this.handleImageError);f.src=this._imageSource(h,d);f.startBase=(d*h.basesPerTile);f.baseWidth=h.basesPerTile;f.tileNum=d;this.tileToImage[d]=f}j.push(f)}return j};TiledImageStore.Fixed.prototype._imageSource=function(a,b){return Util.resolveUrl(this.url,a.urlPrefix+b+".png")};TiledImageStore.Fixed.prototype.clearCache=function(){this.tileToImage={}};TiledImageStore.Fixed.prototype.unCacheImage=function(a){delete this.tileToImage[a.tileNum]};var TiledImageStore;if(!TiledImageStore){TiledImageStore={}}TiledImageStore.Fixed_v0=function(a){TiledImageStore.Fixed.call(this,a)};TiledImageStore.Fixed_v0.prototype=new TiledImageStore.Fixed("");TiledImageStore.Fixed_v0.prototype._imageSource=function(a,b){return Util.resolveUrl(this.url,"../../"+a.urlPrefix+b+".png")};var SequenceStore;if(!SequenceStore){SequenceStore={}}SequenceStore.StaticChunked=function(a){Store.call(this,a);this.chunkCache={};this.compress=a.compress;this.urlTemplate=a.urlTemplate;this.baseUrl=a.baseUrl};SequenceStore.StaticChunked.prototype=new Store("");SequenceStore.StaticChunked.prototype.getRange=function(n,c,f,m){var h=n.name;var d=n.seqChunkSize;var e=Math.floor(Math.max(0,c)/d);var j=Math.floor((f-1)/d);var k;if(e!=j){m=(function(){var p=[],q=j-e+1,o=m;return function(u,r,s,t){p[t]=s;if(--q==0){o(u,r,p.join(""))}}})()}var l={start:c,end:f,callback:m};if(!this.chunkCache[h]){this.chunkCache[h]=[]}var b=this.chunkCache[h];for(var g=e;g<=j;g++){k=b[g];if(k){if(k.loaded){m(c,f,k.sequence.substring(c-g*d,f-g*d),g)}else{k.callbacks.push(l)}}else{k={loaded:false,num:g,callbacks:[l]};b[g]=k;var a=Util.resolveUrl(this.baseUrl,Util.fillTemplate(this.urlTemplate,{refseq:n.name}));dojo.xhrGet({url:a+g+".txt"+(this.compress?"z":""),load:function(o){var p;k.sequence=o;for(var q=0;q<k.callbacks.length;q++){p=k.callbacks[q];p.callback(p.start,p.end,o.substring(p.start-k.num*d,p.end-k.num*d),g)}k.callbacks=undefined;k.loaded=true}})}}};dojo.declare("JBrowse.Model.AutocompleteStore",null,{constructor:function(c){if(!c.namesTrie){throw"must provide a namesTrie argument"}this.namesTrie=c.namesTrie;this.resultLimit=c.resultLimit||15;this.tooManyMatchesMessage=c.tooManyMatchesMessage||"(too many matches to display)";var a=this.stopPrefixes={};if(c.stopPrefixes){var b=typeof c.stopPrefixes=="string"?[c.stopPrefixes]:c.stopPrefixes;dojo.forEach(b,function(d){while(d.length){a[d]=true;d=d.substr(0,d.length-1)}})}this.nodeText=function(d){if(typeof d[1][0][0]=="number"){this.nodeText=function(e){return e[0]}}else{this.nodeText=function(e){return e[1][0][0]}}return this.nodeText(d)}},fetch:function(d){var b=d.start||0;var g=Math.min(this.resultLimit,Math.max(0,d.count));var h=g;var j=d.scope||dojo.global;var a=false;d.abort=function(){var k=d.abort||function(){};return function(){a=true;k.call(j,d)}}.call(this);if(!d.store){d.store=this}var c=false;var e=[];var f=(d.query.name||"").replace(/\*$/,"");if(!this.stopPrefixes[f]){this.namesTrie.mappingsFromPrefix(f,dojo.hitch(this,function(k){c=true;dojo.some(k,function(l){if(h--){e.push({name:this.nodeText(l)})}return h<0},this)}))}if(h<0){e.push({name:this.tooManyMatchesMessage,hitLimit:true})}if(d.onBegin){d.onBegin.call(j,e.length,d)}if(d.sort){e.sort(dojo.data.util.sorter.createSortFunction(d.sort,this))}if(d.onItem){dojo.forEach(e,function(k){if(!a){d.onItem.call(j,k,d)}})}if(d.onComplete&&!a){d.onComplete.call(j,e,d)}},getValue:function(d,a,b){var c=d[a];return typeof c=="undefined"?b:c},getValues:function(d,b){var c=[d[b]];return typeof c[0]=="undefined"?[]:c},getAttributes:function(a){return dojof.keys(a)},hasAttribute:function(b,a){return b.hasOwnProperty(a)},containsValue:function(b,a,c){return b[a]==c},isItem:function(a){return typeof a=="object"&&typeof a.label=="string"},isItemLoaded:function(){return true},loadItem:function(a){},close:function(){},getLabel:function(a){return this.getValue(a,"name",undefined)},getLabelAttributes:function(a){return["name"]}});dojo.declare("JBrowse.Model.TrackMetaData",null,{_noDataValue:"(no data)",constructor:function(c){var b=["conf"];this._filterFacet=(function(){var g=c.indexFacets||function(){return true};if(typeof g=="string"){g=[g]}if(Array.isArray(g)){var f=g;g=function(h){return dojo.some(f,function(j){return h==j.toLowerCase()})}}var e=this.getIdentityAttributes();return function(h){return(dojo.some(e,function(j){return j==h})||g(h)&&!dojo.some(b,function(j){return j==h}))}}).call(this);if(!dojo.isArray(c.onReady)){this.onReadyFuncs=c.onReady?[c.onReady]:[]}else{this.onReadyFuncs=dojo.clone(c.onReady)}this._indexItems({store:this,items:dojo.map(c.trackConfigs,function(e){var f=dojo.clone(e.metadata||{});f.label=e.label;f.key=e.key;f.conf=e;if(e.category){f.category=e.category}return f},this)});var d=0;c.metadataStores=dojo.filter(c.metadataStores,function(e){return e});if(!c.metadataStores||!c.metadataStores.length){this._finishLoad()}else{var a=dojo.hitch(this,function(){if(++d==c.metadataStores.length){this._finishLoad()}});dojo.forEach(c.metadataStores,function(e){e.fetch({scope:this,onComplete:dojo.hitch(this,function(f){this._indexItems({store:e,items:f,supplementalOnly:true});a()}),onError:function(f){console.error(""+f);a()}})},this)}},_finishLoad:function(){this.facets.sort();dojo.forEach(dojof.values(this.facetIndexes.byName),function(b){b.avgBucketSize=b.itemCount/b.bucketCount});this.facetIndexes.facetRank=dojo.clone(this.facets).sort(dojo.hitch(this,function(d,c){return this.facetIndexes.byName[d].avgBucketSize-this.facetIndexes.byName[c].avgBucketSize}));var a=dojo.hitch(this,"_itemSortFunc");dojo.forEach(dojof.values(this.facetIndexes.byName),function(b){dojo.forEach(dojof.keys(b.byValue),function(c){b.byValue[c].items=b.byValue[c].items.sort(a)})},this);this.ready=true;this._onReady()},_itemSortFunc:function(e,d){var c=this.getIdentity(e),f=this.getIdentity(d);return c==f?0:c>f?1:c<f?-1:0},_indexItems:function(d){var b=d.store,a=d.items;var c={};a=dojo.map(a,function(h){var g=b.getAttributes(h);var j={};dojo.forEach(g,function(k){var l=k.toLowerCase();c[l]=true;j[l]=b.getValue(h,k)});return j},this);this.identIndex=this.identIndex||{};a=(function(){var g={};return dojo.map(a,function(j){var k=this.getIdentity(j);var h=this.identIndex[k];if(g[k]||d.supplementalOnly&&!h){return null}g[k]=true;return this.identIndex[k]=dojo.mixin(h||{},j)},this)}).call(this);a=dojo.filter(a,function(g){return g});var f=this._addFacets(dojof.keys(c));this.facetIndexes=this.facetIndexes||{itemCount:0,bucketCount:0,byName:{}};dojo.forEach(f,function(g){if(!this.facetIndexes.byName[g]){this.facetIndexes.bucketCount++;this.facetIndexes.byName[g]={itemCount:0,bucketCount:0,byValue:{}}}},this);if(f.length){var e={};dojo.forEach(f,function(g){e[g]={}});dojo.forEach(a,function(g){this.facetIndexes.itemCount++;dojo.forEach(f,function(j){var h=this.getValue(g,j,undefined);if(typeof h=="undefined"){return}e[j][this.getIdentity(g)]=1;this._indexItem(j,h,g)},this)},this);dojo.forEach(f,function(h){var g=false;dojo.forEach(dojof.values(this.identIndex),function(j){if(!e[h][this.getIdentity(j)]){g=true;this._indexItem(h,this._noDataValue,j)}},this)},this)}},_indexItem:function(e,c,b){var a=this.facetIndexes.byName[e];var d=a.byValue[c];if(!d){d=a.byValue[c]={itemCount:0,items:[]};a.bucketCount++}d.itemCount++;a.itemCount++;d.items.push(b)},_addFacets:function(a){var b=this.facets||[];var c={};this.facets=dojo.filter(b.concat(a),function(d){var e=this._filterFacet(d)&&!c[d];c[d]=true;return e},this);return this.facets.slice(b.length)},getCount:function(){return this._fetchCount},getFacetCounts:function(a){var b=this._fetchFacetCounts[a]||this._fetchFacetCounts.__other__;return b?b[a]:undefined},getFacetNames:function(a){return this.facets},getFacetValues:function(a){var b=this.facetIndexes.byName[a];if(!b){return[]}return dojof.keys(b.byValue)},getFacetStats:function(a){var b=this.facetIndexes.byName[a];if(!b){return{}}var c={};dojo.forEach(["itemCount","bucketCount","avgBucketSize"],function(d){c[d]=b[d]});return c},getValue:function(d,a,b){var c=d[a];return typeof c=="undefined"?b:c},getValues:function(d,b){var c=[d[b]];return typeof c[0]=="undefined"?[]:c},getAttributes:function(a){return dojof.keys(a)},hasAttribute:function(b,a){return b.hasOwnProperty(a)},containsValue:function(b,a,c){return b[a]==c},isItem:function(a){return typeof a=="object"&&typeof a.label=="string"},isItemLoaded:function(){return true},loadItem:function(a){},_fetchItems:function(b,f,a){if(!this.ready){this.onReady(dojo.hitch(this,"_fetchItems",b,f,a));return}var d=dojo.clone(b.query||{});dojo.forEach(dojof.keys(d),function(g){if(!Array.isArray(d[g])){d[g]=[d[g]]}},this);var c;var e=Util.objectFingerprint(d);if(e==this.previousQueryFingerprint){c=this.previousResults}else{this.previousQueryFingerprint=e;this.previousResults=c=this._doQuery(d)}f(c,b);this.onFetchSuccess()},_doQuery:function(j){var m=this._compileTextFilter(j.text);delete j.text;var f=[];var c=[];if(m){c.push(dojo.filter(dojof.values(this.identIndex),m).sort(dojo.hitch(this,"_itemSortFunc")));c[0].facetName="Contains text"}c.push.apply(c,dojo.map(dojof.keys(j),function(n){var p=j[n];var o=[];if(!this.facetIndexes.byName[n]){console.error("No facet defined with name '"+n+"'.");throw"No facet defined with name '"+n+"', faceted search failed."}dojo.forEach(p,function(r){var q=this.facetIndexes.byName[n].byValue[r]||{};o.push.apply(o,q.items||[])},this);o.facetName=n;o.sort(dojo.hitch(this,"_itemSortFunc"));return o},this));dojo.forEach(c,function(n){n.myOffset=0;n.topItem=function(){return this[this.myOffset]};n.shift=function(){this.myOffset++}});var l={};if(!c.length){f=dojof.values(this.identIndex)}else{var g=0;dojo.forEach(c,function(n){g+=n.length});while(g){var d={},b=[],e,k;dojo.forEach(c,function(o,n){k=o.topItem();e=k?this.getIdentity(k):"(at end of set)";if(d[e]){d[e].push(o)}else{d[e]=[o];b.push(e)}},this);if(b.length==1){f.push(k)}else{b.sort();var h;if(b[0]=="(at end of set)"){e=b[1];h=0}else{e=b[0];h=1}e=b[0]=="(at end of set)"?b[1]:b[0];if(b.length==2&&d[e].length==c.length-1){var a=d[b[h]][0];this._countItem(l,d[e][0].topItem(),a.facetName)}}dojo.forEach(d[e],function(n){n.shift();g--})}}dojo.forEach(dojof.keys(l).concat(["__other__"]),function(n){dojo.forEach(f,function(o){this._countItem(l,o,n)},this)},this);if(c.length==1){dojo.forEach(dojof.values(this.identIndex),function(n){this._countItem(l,n,c[0].facetName)},this)}this._fetchFacetCounts=l;this._fetchCount=f.length;return f},_countItem:function(b,c,a){var e=b[a];if(!e){e=b[a]={}}var d=a=="__other__"?this.facets:[a];dojo.forEach(d,function(f){var h=this.getValue(c,f,this._noDataValue);var g=e[f];if(!g){g=e[f]={};g[h]=0}g[h]=(g[h]||0)+1},this)},onReady:function(a,b){a=a||dojo.global;b=dojo.hitch(a,b);if(!this.ready){this.onReadyFuncs.push(b);return}else{b()}},_onReady:function(){dojo.forEach(this.onReadyFuncs||[],function(a){a.call()})},onFetchSuccess:function(){},_compileTextFilter:function(a){if(a===undefined){return null}var b=/\s*["']([^"']+)["']\s*/g;var e=/(\S+)/g;var c=function(){var g=b.exec(a)||e.exec(a);if(g){g=g[1];var h=Math.max(b.lastIndex,e.lastIndex);e.lastIndex=b.lastIndex=h}return g};var f=[];var d;while((d=c())){d=dojo.regexp.escapeString(d,"*?").replace(/\*/g,".+").replace(/ /g,"\\s+").replace(/\?/g,".");f.push(new RegExp(d,"i"))}return dojo.hitch(this,function(g){return dojo.some(this.facets,function(h){var j=this.getValue(g,h);return dojof.every(f,function(k){return k.test(j)})},this)})},getFeatures:function(){return{"dojo.data.api.Read":true,"dojo.data.api.Identity":true}},close:function(){},getLabel:function(a){return this.getValue(a,"key",undefined)},getLabelAttributes:function(a){return["key"]},getIdentityAttributes:function(){return["label"]},getIdentity:function(a){return this.getValue(a,"label",undefined)},fetchItemByIdentity:function(a){return this.identIndex[a]}});dojo.require("dojo.data.util.simpleFetch");dojo.extend(JBrowse.Model.TrackMetaData,dojo.data.util.simpleFetch);dojo.declare("JBrowse.View.TrackList.Null",null,{setTracksActive:function(){},setTracksInactive:function(){},show:function(){},hide:function(){},toggle:function(){}});dojo.declare("JBrowse.View.TrackList.Simple",null,{constructor:function(a){this.createTrackList(a.browser.container);this.trackListWidget.insertNodes(false,a.trackConfigs);dojo.subscribe("/dnd/drop",this,function(c,b,f,e){if(e!==this.trackListWidget){return}var d=dojo.filter(dojo.map(b,function(g){return g.track&&g.track.config}),function(g){return g});if(!d.length){return}this.dndDrop=true;dojo.publish("/jbrowse/v1/v/tracks/hide",[d]);this.dndDrop=false});dojo.subscribe("/jbrowse/v1/c/tracks/show",dojo.hitch(this,"setTracksActive"));dojo.subscribe("/jbrowse/v1/c/tracks/hide",dojo.hitch(this,"setTracksInactive"))},createTrackList:function(d){var a=dojo.create("div",{id:"trackPane",style:{width:"10em"}},d);var c=new dijit.layout.ContentPane({region:"left",splitter:true},a);var b=dojo.create("div",{id:"tracksAvail",className:"container handles",style:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},innerHTML:"<h2>Available Tracks</h2>"},a);this.trackListWidget=new dojo.dnd.Source(b,{accept:["track"],withHandles:false,creator:function(g,h){var f=dojo.create("div",{className:"tracklist-label",title:"to turn on, drag into track area",innerHTML:g.key});if("avatar"!=h){var e=dojo.create("div",{className:"tracklist-container"});e.appendChild(f);f=e}f.id=dojo.dnd.getUniqueId();return{node:f,data:g,type:["track"]}}});return b},setTracksActive:function(a){dojo.forEach(a||[],function(b){this.trackListWidget.forInItems(function(e,f,d){if(b.label===e.data.label){this.trackListWidget.delItem(f);var c=dojo.byId(f);if(c&&c.parentNode){c.parentNode.removeChild(c)}}},this)},this)},setTracksInactive:function(a){if(!this.dndDrop){this.trackListWidget.insertNodes(false,a)}},show:function(){},hide:function(){},toggle:function(){}});dojo.declare("JBrowse.View.TrackList.Faceted",null,{constructor:function(a){dojo.require("dojox.grid.EnhancedGrid");dojo.require("dojox.grid.enhanced.plugins.IndirectSelection");dojo.require("dijit.layout.AccordionContainer");dojo.require("dijit.layout.AccordionPane");this.browser=a.browser;this.tracksActive={};this.config=a;this._isSelectableFacet=this._coerceFilter(a.selectableFacetFilter||function(b,c){return(c.getFacetStats(b).avgBucketSize>1&&!dojo.some(c.getLabelAttributes().concat(c.getIdentityAttributes()),function(d){return d==b}))});this.displayColumns=a.displayColumns;this._isDisplayableColumn=this._coerceFilter(a.displayColumnFilter||function(b){return b.toLowerCase()!="label"});this.trackDataStore=a.trackMetaData;dojo.subscribe("/jbrowse/v1/c/tracks/show",dojo.hitch(this,"setTracksActive"));dojo.subscribe("/jbrowse/v1/c/tracks/hide",dojo.hitch(this,"setTracksInactive"));this.renderInitial();this.trackDataStore.onReady(this,function(){this.renderSelectors();dojo.connect(this.dataGrid.selection,"onSelected",this,function(b){this._ifNotSuppressed("selectionEvents",function(){this._suppress("gridUpdate",function(){dojo.publish("/jbrowse/v1/v/tracks/show",[[this.dataGrid.getItem(b).conf]])})})});dojo.connect(this.dataGrid.selection,"onDeselected",this,function(b){this._ifNotSuppressed("selectionEvents",function(){this._suppress("gridUpdate",function(){dojo.publish("/jbrowse/v1/v/tracks/hide",[[this.dataGrid.getItem(b).conf]])})})})});this.trackDataStore.onReady(this,"_updateFacetCounts");dojo.connect(this.trackDataStore,"onFetchSuccess",this,"_updateGridSelections");dojo.connect(this.trackDataStore,"onFetchSuccess",this,"_updateMatchCount")},_coerceFilter:function(a){if(typeof a=="string"){a=[a]}if(Array.isArray(a)){a=function(c,b){return dojo.some(a,function(d){return b==d})}}return a},_ifNotSuppressed:function(a,b){if(typeof a=="string"){a=[a]}if(!this.suppress){this.suppress={}}if(dojo.some(a,function(c){return this.suppress[c]},this)){return undefined}return b.call(this)},_suppress:function(b,c){if(typeof b=="string"){b=[b]}if(!this.suppress){this.suppress={}}dojo.forEach(b,function(d){this.suppress[d]=true},this);var a=c.call(this);dojo.forEach(b,function(d){this.suppress[d]=false},this);return a},_suppressRecursion:function(b){var a=["method_"+b];var c=this[b];return this._ifNotSuppressed(a,function(){this._suppress(a,c)})},renderInitial:function(){this.containerElem=dojo.create("div",{id:"faceted_tracksel",style:{left:"-95%",width:"95%",zIndex:500}},document.body);dojo.create("div",{className:"faceted_tracksel_on_off tab",innerHTML:'<img src="img/left_arrow.png"><div>Select<br>tracks</div>'},this.containerElem);this.mainContainer=new dijit.layout.BorderContainer({design:"headline",gutters:false},dojo.create("div",{className:"mainContainer"},this.containerElem));this.topPane=new dijit.layout.ContentPane({region:"top",id:"faceted_tracksel_top",content:'<div class="title">Select Tracks</div> <div class="topLink" style="cursor: help"><a title="Track selector help">Help</a></div>'});dojo.query('div.topLink a[title="Track selector help"]',this.topPane.domNode).forEach(function(b){var c=new dijit.Dialog({"class":"help_dialog",refocus:false,draggable:false,title:"Track Selection",content:'<div class="main"><p>The JBrowse Faceted Track Selector makes it easy to search through large numbers of available tracks to find exactly the ones you want. You can incrementally filter the track display to narrow it down to those your are interested in.  There are two types of filtering available, which can be used together: <b>filtering with data fields</b>, and free-form <b>filtering with text</b>.</p>  <dl><dt>Filtering with Data Fields</dt>  <dd>The left column of the display contains the available <b>data fields</b>.  Click on the data field name to expand it, and then select one or more values for that field.  This narrows the search to display only tracks that have one of those values for that field.  You can do this for any number of fields.<dd>  <dt>Filtering with Text</dt>  <dd>Type text in the "Contains text" box to filter for tracks whose data contains that text.  If you type multiple words, tracks are filtered such that they must contain all of those words, in any order.  Placing "quotation marks" around the text filters for tracks that contain that phrase exactly.  All text matching is case insensitive.</dd>  <dt>Activating Tracks</dt>  <dd>To activate and deactivate a track, click its check-box in the left-most column.  When the box contains a check mark, the track is activated.  You can also turn whole groups of tracks on and off using the check-box in the table heading.</dd>  </dl></div>'});dojo.connect(b,"onclick",this,function(d){c.show();return false})},this);this.mainContainer.addChild(this.topPane);dojo.query(".faceted_tracksel_on_off").onclick(dojo.hitch(this,"toggle"));this.centerPane=new dijit.layout.BorderContainer({region:"center","class":"gridPane",gutters:false});this.mainContainer.addChild(this.centerPane);var a=this.renderTextFilter();this.busyIndicator=dojo.create("div",{innerHTML:'<img src="img/spinner.gif">',className:"busy_indicator"},this.containerElem);this.centerPane.addChild(new dijit.layout.ContentPane({region:"top","class":"gridControls",content:[dojo.create("button",{className:"faceted_tracksel_on_off",innerHTML:'<img src="img/left_arrow.png"> <div>Back to browser</div>',onclick:dojo.hitch(this,"hide")}),dojo.create("button",{className:"clear_filters",innerHTML:'<img src="img/red_x.png"><div>Clear All Filters</div>',onclick:dojo.hitch(this,function(b){this._clearTextFilterControl();this._clearAllFacetControls();this._async(function(){this.updateQuery();this._updateFacetCounts()},this).call()})}),this.busyIndicator,a,dojo.create("div",{className:"matching_record_count"})]}))},renderSelectors:function(){var a=this.renderFacetSelectors();a.set("region","left");this.mainContainer.addChild(a);this.dataGrid=this.renderGrid();this.dataGrid.set("region","center");this.centerPane.addChild(this.dataGrid);this.mainContainer.startup()},_async:function(c,a){var b=this;return function(){var d=arguments;var e=this;b._busy(true);window.setTimeout(function(){c.apply(a||e,d);b._busy(false)},50)}},_busy:function(a){this.busyCount=Math.max(0,(this.busyCount||0)+(a?1:-1));if(this.busyCount>0){dojo.addClass(this.containerElem,"busy")}else{dojo.removeClass(this.containerElem,"busy")}},renderGrid:function(){var a=new dojox.grid.EnhancedGrid({id:"trackSelectGrid",store:this.trackDataStore,selectable:true,noDataMessage:"No tracks match the filtering criteria.",structure:[dojo.map(dojo.filter(this.displayColumns||this.trackDataStore.getFacetNames(),dojo.hitch(this,"_isDisplayableColumn")),function(b){b={name:"key"}[b.toLowerCase()]||b;return{name:this._facetDisplayName(b),field:b.toLowerCase(),width:"100px"}},this)],plugins:{indirectSelection:{headerSelector:true}}});this._monkeyPatchGrid(a);return a},_facetDisplayName:function(a){this.renameFacets=this.renameFacets||function(){var b=this.config.renameFacets||{};b.key=b.key||"Name";return b}.call(this);return this.renameFacets[a]||Util.ucFirst(a.replace("_"," "))},_monkeyPatchGrid:function(a){a.onRowClick=function(){};var b=a.selection.selectRange;a.selection.selectRange=function(c,d){var e=30;if(d-c>e){alert("Too many tracks selected, please select fewer than "+e+" tracks.");return undefined}return b.apply(this,arguments)};a.views.views[0].doscroll=function(c){var f=dojo._isBodyLtr();if(this.firstScroll<2){if((!f&&this.firstScroll==1)||(f&&this.firstScroll===0)){var d=dojo.marginBox(this.headerNodeContainer);if(dojo.isIE){this.headerNodeContainer.style.width=d.w+this.getScrollbarWidth()+"px"}else{if(dojo.isMoz){this.headerNodeContainer.style.width=d.w-this.getScrollbarWidth()+"px";this.scrollboxNode.scrollLeft=f?this.scrollboxNode.clientWidth-this.scrollboxNode.scrollWidth:this.scrollboxNode.scrollWidth-this.scrollboxNode.clientWidth}}}this.firstScroll++}this.headerNode.scrollLeft=this.scrollboxNode.scrollLeft;var e=this.scrollboxNode.scrollTop;if(Math.abs(e-this.lastTop)>1){this.grid.scrollTo(e)}}},renderTextFilter:function(a){this.textFilterLabel=dojo.create("label",{className:"textFilterControl",innerHTML:"Contains text ",id:"tracklist_textfilter",style:{position:"relative"}},a);this.textFilterInput=dojo.create("input",{type:"text",size:40,disabled:true,onkeypress:dojo.hitch(this,function(b){if(b.keyCode==dojo.keys.SHIFT||b.keyCode==dojo.keys.CTRL||b.keyCode==dojo.keys.ALT){return}if(this.textFilterTimeout){window.clearTimeout(this.textFilterTimeout)}this.textFilterTimeout=window.setTimeout(dojo.hitch(this,function(){this._updateTextFilterControl();this._async(function(){this.updateQuery();this._updateFacetCounts();this.textFilterInput.focus()},this).call();this.textFilterInput.focus()}),500);this._updateTextFilterControl();b.stopPropagation()})},this.textFilterLabel);this.textFilterClearButton=dojo.create("img",{src:"img/red_x.png",className:"text_filter_clear",onclick:dojo.hitch(this,function(){this._clearTextFilterControl();this._async(function(){this.updateQuery();this._updateFacetCounts()},this).call()}),style:{position:"absolute",right:"4px",top:"20%"}},this.textFilterLabel);return this.textFilterLabel},_clearTextFilterControl:function(){this.textFilterInput.value="";this._updateTextFilterControl()},_updateTextFilterControl:function(){if(this.textFilterInput.value.length){dojo.addClass(this.textFilterLabel,"selected")}else{dojo.removeClass(this.textFilterLabel,"selected")}},renderFacetSelectors:function(){var a=new dijit.layout.AccordionContainer({style:"width: 200px"});var c=this.trackDataStore;this.facetSelectors={};var b=this._renderFacetSelector("My Tracks",["Currently Active","Recently Used"]);b.set("class","myTracks");a.addChild(b);var d=dojo.filter(this.config.selectableFacets||c.getFacetNames(),function(e){return this._isSelectableFacet(e,this.trackDataStore)},this);dojo.forEach(d,function(e){var f=c.getFacetValues(e).sort();if(!f||!f.length){return}var g=this._renderFacetSelector(e,f);a.addChild(g)},this);return a},_renderFacetSelector:function(a,c){var d=new dijit.layout.AccordionPane({title:'<div id="facet_title_'+a+'" class="facetTitle">'+this._facetDisplayName(a)+' <a class="clearFacet"><img src="img/red_x.png" /></a></div>'});var b=dojo.create("table",{className:"facetSelect"},d.containerNode);this.facetSelectors[a]=dojo.map(c,function(g){var f=this;var e=dojo.create("tr",{className:"facetValue",innerHTML:'<td class="count"></td><td class="value">'+g+"</td>",onclick:function(h){dojo.toggleClass(this,"selected");f._updateFacetControl(a);f._async(function(){f.updateQuery();f._updateFacetCounts(a)}).call()}},b);e.facetValue=g;return e},this);return d},_clearAllFacetControls:function(){dojo.forEach(dojof.keys(this.facetSelectors),function(a){this._clearFacetControl(a)},this)},_clearFacetControl:function(a){dojo.forEach(this.facetSelectors[a]||[],function(b){dojo.removeClass(b,"selected")},this);this._updateFacetControl(a)},_updateFacetCounts:function(a){dojo.forEach(dojof.keys(this.facetSelectors),function(b){if(b=="My Tracks"){return}var c=this.trackDataStore.getFacetCounts(b);dojo.forEach(this.facetSelectors[b]||[],function(d){dojo.query(".count",d).forEach(function(f){var e=c?c[d.facetValue]||0:0;f.innerHTML=Util.addCommas(e);if(e){dojo.removeClass(d,"disabled")}else{dojo.addClass(d,"disabled")}},this)},this);this._updateFacetControl(b)},this)},_updateFacetControl:function(a){var c=dojo.byId("facet_title_"+a);if(dojo.every(this.facetSelectors[a]||[],function(d){return dojo.hasClass(d,"disabled")},this)){dojo.addClass(c,"disabled")}if(dojo.some(this.facetSelectors[a]||[],function(d){return dojo.hasClass(d,"selected")},this)){var b=dojo.hitch(this,function(d){this._clearFacetControl(a);this._async(function(){this.updateQuery();this._updateFacetCounts(a)},this).call();d.stopPropagation()});dojo.addClass(c,"selected");dojo.query("> a",c).forEach(function(d){d.onclick=b},this).attr("title","clear selections")}else{dojo.removeClass(c,"selected");dojo.query("> a",c).onclick(function(){return false}).removeAttr("title")}},updateQuery:function(){this._suppressRecursion("_updateQuery")},_updateQuery:function(){var a={};var b=function(c){return dojo.hasClass(c,"selected")};(function(){var e=this.facetSelectors["My Tracks"];var c={};dojo.forEach(e,function(g){c[g.facetValue]=g});if(b(c["Currently Active"])){var d=dojof.keys(this.tracksActive||{});a.label=Util.uniq((a.label||[]).concat(d))}if(b(c["Recently Used"])){var f=dojo.map(this.browser.getRecentlyUsedTracks(),function(g){return g.label});a.label=Util.uniq((a.label||[]).concat(f))}if((!a.label||!a.label.length)&&dojo.some(e,b)){a.label=["FAKE LABEL THAT IS HIGHLY UNLIKELY TO EVER MATCH ANYTHING"]}}).call(this);if(this.textFilterInput.value.length){a.text=this.textFilterInput.value}dojo.forEach(this.trackDataStore.getFacetNames(),function(c){var d=this.facetSelectors[c];if(!d){return}var e=dojo.map(dojo.filter(d,b),function(f){return f.facetValue});if(e.length){a[c]=e}},this);this.query=a;this.dataGrid.setQuery(this.query);this._updateMatchCount()},_updateMatchCount:function(){var a=this.dataGrid.store.getCount();dojo.query(".matching_record_count",this.containerElem).forEach(function(b){b.innerHTML=Util.addCommas(a)+" matching track"+(a==1?"":"s")})},_updateGridSelections:function(){this._ifNotSuppressed("gridUpdate",function(){this._suppress("selectionEvents",function(){this.dataGrid.selection.deselectAll();for(var b=0;b<Math.min(this.dataGrid.get("rowCount"),this.dataGrid.get("rowsPerPage"));b++){var c=this.dataGrid.getItem(b);var a=this.dataGrid.store.getIdentity(c);if(this.tracksActive[a]){this.dataGrid.rowSelectCell.toggleRow(b,true)}}})})},setTracksActive:function(a){dojo.forEach(a,function(b){this.tracksActive[b.label]=true},this)},setTracksInactive:function(a){dojo.forEach(a,function(b){delete this.tracksActive[b.label]},this)},show:function(){window.setTimeout(dojo.hitch(this,function(){this.textFilterInput.disabled=false;this.textFilterInput.focus()}),300);dojo.addClass(this.containerElem,"active");dojo.animateProperty({node:this.containerElem,properties:{left:{start:-95,end:0,units:"%"}}}).play();this.shown=true},hide:function(){dojo.removeClass(this.containerElem,"active");dojo.animateProperty({node:this.containerElem,properties:{left:{start:0,end:-95,units:"%"}}}).play();this.textFilterInput.blur();this.textFilterInput.disabled=true;this.shown=false},toggle:function(){this.shown?this.hide():this.show()}});function Ruler(a){dojo.mixin(this,a)}Ruler.prototype.render_to=function(e){if(typeof e=="string"){e=dojo.byId(e)}var b=dojo.coords(e);var d=document.createElement("div");var c=Math.floor(Math.log(this.max+1)/Math.log(10))+1;dojo.style(d,{position:"absolute",left:"-9px",bottom:"-13px",width:(40+4*c)+"px",height:(b.h+26)+"px"});e.appendChild(d);try{dojo.require("dojox.charting.Chart2D");var f=new dojox.charting.Chart2D(d,{fill:"transparent"});f.addAxis("y",{vertical:true,fill:"transparent",min:this.min,max:this.max});f.addPlot("default",{type:"Bubble",fill:"transparent"});f.render();var g=d.childNodes[0].childNodes[1];if(g){g.setAttribute("fill-opacity",0)}}catch(a){console.error(a+"");console.error("Failed to draw Ruler with SVG, your browser may not support the necessary technology.");e.removeChild(d)}};var Track;if(!Track){Track={}}Track.YScaleMixin={makeYScale:function(b){var c=b&&typeof b.min=="number"?b.min:this.min;var a=b&&typeof b.max=="number"?b.max:this.max;var d=document.createElement("div");this.yscale=d;d.className="ruler vertical_ruler";dojo.style(d,{height:this.height+"px",position:"absolute",width:"100px",zIndex:17});if(this.window_info&&"x" in this.window_info){d.style.left=(this.window_info.x+(this.window_info.width||0)/2)+"px"}dojo.style(d,(this.config.align=="top"?{top:"0px"}:{bottom:this.trackPadding+"px"}));this.div.appendChild(d);var e=new Ruler({min:c,max:a,direction:"up"});e.render_to(d)},updateYScaleFromViewDimensions:function(a){if(typeof a.x=="number"||typeof a.width=="number"){if(this.yscale){this.yscale.style.left=(this.window_info.x+(this.window_info.width||0)/2)+"px"}}}};function FeatureTrack(a,d,c){Track.call(this,a.label,a.key,false,c.changeCallback);this.fields={};this.refSeq=d;var b=a.backendVersion==0?SeqFeatureStore.NCList_v0:SeqFeatureStore.NCList;this.featureStore=new b({urlTemplate:a.urlTemplate,baseUrl:a.baseUrl,refSeq:d,track:this});dojo.connect(this.featureStore,"loadSuccess",this,"loadSuccess");dojo.connect(this.featureStore,"loadFail",this,"loadFail");this.numBins=25;this.histLabel=false;this.padding=5;this.trackPadding=c.trackPadding;this.config=a}FeatureTrack.prototype=new Track("");FeatureTrack.prototype.load=function(){this.featureStore.load()};dojo.mixin(FeatureTrack.prototype,Track.YScaleMixin);FeatureTrack.prototype.loadSuccess=function(d,b){var a={style:{className:"feature2"},scaleThresh:{hist:4,label:50,subfeature:80},hooks:{create:function(f,h){var e;var g=f.featureUrl(h);if(g){e=document.createElement("a");e.href=g;e.target="_new"}else{e=document.createElement("div")}return e}},events:{}};if(!this.config.style.linkTemplate){a.events.click=function(e,h,f,g){alert("clicked on feature\nstart: "+(Number(f.get("start"))+1)+", end: "+Number(f.get("end"))+", strand: "+f.get("strand")+", label: "+f.get("name")+", ID: "+f.get("id"))}}Util.deepUpdate(a,this.config);this.config=a;this.config.hooks.create=this.evalHook(this.config.hooks.create);this.config.hooks.modify=this.evalHook(this.config.hooks.modify);this.eventHandlers={};for(var c in this.config.events){this.eventHandlers[c]=this.wrapHandler(this.evalHook(this.config.events[c]))}this.labelScale=this.featureStore.density*this.config.scaleThresh.label;this.setLoaded()};FeatureTrack.prototype.evalHook=function(hook){if(!("string"==typeof hook)){return hook}var result;try{result=eval("("+hook+")")}catch(e){console.log("eval failed for hook on track "+this.name+": "+hook)}return result};FeatureTrack.prototype.wrapHandler=function(b){var a=this;return function(d){d=d||window.event;if(d.shiftKey){return}var c=(d.currentTarget||d.srcElement);if(!c.feature){c=c.parentElement}if(!c.feature){return}b(a,c,c.feature,d)}};FeatureTrack.prototype.setViewInfo=function(c,g,a,d,b,f,e){Track.prototype.setViewInfo.apply(this,arguments);this.setLabel(this.key)};FeatureTrack.prototype._histDimensions=function(d){var a=d/this.numBins;var g=2;var f=false;var c=this.featureStore.histograms.stats;var e;for(var b=0;b<c.length;b++){if(c[b].basesPerBin>=a){f=((c[b].mean/c[b].max)<0.01);g=100/(f?Math.log(c[b].max):c[b].max);e=c[b];break}}return{bpPerBin:a,pxPerCount:g,logScale:f,stats:e}};FeatureTrack.prototype.fillHist=function(l,b,o,f,g){var j=this._histDimensions(Math.abs(f-o));var a=this;var m=function(s){var r=0;for(var q=0;q<a.numBins;q++){if(typeof s[q]=="number"&&isFinite(s[q])){r=Math.max(r,s[q])}}var p;for(var q=0;q<a.numBins;q++){if(!(typeof s[q]=="number"&&isFinite(s[q]))){continue}p=document.createElement("div");p.className=a.config.style.className+"-hist";p.style.cssText="left: "+((q/a.numBins)*100)+"%; height: "+(j.pxPerCount*(j.logScale?Math.log(s[q]):s[q]))+"px;bottom: "+a.trackPadding+"px;width: "+(((1/a.numBins)*100)-(100/g))+"%;"+(a.config.style.histCss?a.config.style.histCss:"");if(Util.is_ie6){p.appendChild(document.createComment())}b.appendChild(p)}a.heightUpdate(j.pxPerCount*(j.logScale?Math.log(r):r),l);a.makeHistogramYScale(Math.abs(f-o))};var c=this.featureStore.histograms.meta[0];for(var d=0;d<this.featureStore.histograms.meta.length;d++){if(j.bpPerBin>=this.featureStore.histograms.meta[d].basesPerBin){c=this.featureStore.histograms.meta[d]}}var e=j.bpPerBin/c.basesPerBin;if((e>0.9)&&(Math.abs(e-Math.round(e))<0.0001)){var k=Math.floor(o/c.basesPerBin);e=Math.round(e);var h=[];for(var n=0;n<this.numBins;n++){h[n]=0}c.lazyArray.range(k,k+(e*this.numBins),function(p,q){h[Math.floor((p-k)/e)]+=q},function(){m(h)})}else{this.featureStore.histogram(o,f,this.numBins,m)}};FeatureTrack.prototype.endZoom=function(b,a){this.clear()};FeatureTrack.prototype.updateStaticElements=function(a){Track.prototype.updateStaticElements.apply(this,arguments);this.updateYScaleFromViewDimensions(a);this.updateFeatureLabelPositions(a)};FeatureTrack.prototype.updateFeatureLabelPositions=function(a){if(!"x" in a||this.scale<this.labelScale){return}dojo.query(".block",this.div).forEach(function(d){var b=100*(a.x-d.offsetLeft)/d.offsetWidth+2;if(!b){return}var c=d.endBase-d.startBase;dojo.query(".feature",d).forEach(function(e){if(!e.label){return}var j=e.label;var h=e.feature;var f=parseInt(h.get("start"));f=100*(f-d.startBase)/c;var g=parseInt(h.get("end"));g=100*((g-d.startBase)/c-j.offsetWidth/d.offsetWidth);j.style.left=Math.max(f,Math.min(b,g))+"%"},this)},this)};FeatureTrack.prototype.fillBlock=function(h,b,d,j,l,e,a,g,f,k){var c=Math.abs(l-e);if(this._updatedLabelForBlockSize!=c){if(a<(this.featureStore.density*this.config.scaleThresh.hist)){this.setLabel(this.key+"<br>per "+Util.addCommas(Math.round(c/this.numBins))+" bp")}else{this.setLabel(this.key)}this._updatedLabelForBlockSize=c}if(this.featureStore.histograms&&(a<(this.featureStore.density*this.config.scaleThresh.hist))){this.fillHist(h,b,l,e,g,f,k)}else{if(this.yscale){this._removeYScale()}this.fillFeatures(h,b,d,j,l,e,a,f,k)}};FeatureTrack.prototype.makeHistogramYScale=function(b){var c=this._histDimensions(b);if(c.logScale){console.error("Log histogram scale axis labels not yet implemented.");return}var a=c.stats?c.stats.max:this.height/c.pxPerCount;a=c.logScale?log(a):a;if(this.yscale&&this.yscale_params&&this.yscale_params.maxval==a&&this.yscale_params.height==this.height&&this.yscale_params.blockbp==b){return}else{this._removeYScale();this.makeYScale({min:0,max:a});this.yscale_params={height:this.height,blockbp:b,maxval:a}}};FeatureTrack.prototype._removeYScale=function(){if(!this.yscale){return}this.yscale.parentNode.removeChild(this.yscale);delete this.yscale_params;delete this.yscale};FeatureTrack.prototype.cleanupBlock=function(a){if(a&&a.featureLayout){a.featureLayout.cleanup()}};FeatureTrack.prototype.transfer=function(d,a,c,k,m){if(!(d&&a)){return}if(!d.featureLayout){return}var h=a.startBase;var g=a.endBase;var f=g-h;var l;var b=(d.startBase<a.startBase)?d.featureLayout.rightOverlaps:d.featureLayout.leftOverlaps;for(var e=0;e<b.length;e++){l=d.featureNodes[b[e].id];if(l&&("label" in l)){l.label.parentNode.removeChild(l.label)}if(l&&l.feature){if(l.layoutEnd>h&&l.feature.get("start")<g){d.removeChild(l);delete d.featureNodes[b[e].id];var j=this.renderFeature(l.feature,b[e].id,a,c,k,m);a.appendChild(j)}}}};FeatureTrack.prototype.fillFeatures=function(m,d,g,n,p,j,b,l,o){this.scale=b;var c=new Layout(p,j);d.featureLayout=c;d.featureNodes={};d.style.backgroundColor="#ddd";var f=false;if(g&&g.featureLayout){g.featureLayout.setRightLayout(c);c.setLeftLayout(g.featureLayout)}if(n&&n.featureLayout){n.featureLayout.setLeftLayout(c);c.setRightLayout(n.featureLayout);f=true}if(!this.haveMeasurements){this.measureStyles();this.haveMeasurements=true}var h=this;var k=function(r,s){var t=s.join(",");if(c.hasSeen(t)){return}var q=h.renderFeature(r,t,d,b,l,o);d.appendChild(q)};var a=f?j:p;var e=f?p:j;this.featureStore.iterate(a,e,k,function(){d.style.backgroundColor="";h.heightUpdate(c.totalHeight,m)})};FeatureTrack.prototype.measureStyles=function(){var c=document.createElement("div");c.className="feature-label";c.style.height="auto";c.style.visibility="hidden";c.appendChild(document.createTextNode("1234567890"));document.body.appendChild(c);this.nameHeight=c.clientHeight;this.nameWidth=c.clientWidth/10;document.body.removeChild(c);var b;c=document.createElement("div");c.className=this.config.style.className+" plus-"+this.config.style.className+" plus-"+this.config.style.className+"1";if(this.config.style.featureCss){c.style.cssText=this.config.style.featureCss}c.style.visibility="hidden";if(Util.is_ie6){c.appendChild(document.createComment("foo"))}document.body.appendChild(c);b=dojo.marginBox(c);this.glyphHeight=Math.round(b.h+2);this.padding+=b.w;document.body.removeChild(c);if(this.config.style.arrowheadClass){var a=document.createElement("div");a.className="plus-"+this.config.style.arrowheadClass;if(Util.is_ie6){a.appendChild(document.createComment("foo"))}document.body.appendChild(a);b=dojo.marginBox(a);this.plusArrowWidth=b.w;a.className="minus-"+this.config.style.arrowheadClass;b=dojo.marginBox(a);this.minusArrowWidth=b.w;document.body.removeChild(a)}};FeatureTrack.prototype.renderFeature=function(g,m,j,z,a,b){var o=g.get("end");var h=g.get("start");if(typeof o=="string"){o=parseInt(o)}if(typeof h=="string"){h=parseInt(h)}var w=this.glyphHeight+2;var A=g.get("name");if(A&&(z>this.labelScale)){o=Math.max(o,h+((A?A.length:0)*(this.nameWidth/z)));w+=this.nameHeight}o+=Math.max(1,this.padding/z);var p=j.featureLayout.addRect(m,h,o,w);var s=this.config.hooks.create(this,g);for(var t in this.eventHandlers){s["on"+t]=this.eventHandlers[t]}s.feature=g;s.layoutEnd=o;s.className=(s.className?s.className+" ":"")+"feature";j.featureNodes[m]=s;var r=g.get("strand");switch(r){case 1:case"+":s.className=s.className+" plus-"+this.config.style.className;break;case -1:case"-":s.className=s.className+" minus-"+this.config.style.className;break;default:s.className=s.className+" "+this.config.style.className;break}var e=g.get("phase");if((e!==null)&&(e!==undefined)){s.className=s.className+" "+s.className+"_phase"+e}var y=Math.max(g.get("start"),a);var d=Math.min(g.get("end"),b);var k=1;var c=j.endBase-j.startBase;var q=Math.max(k,(100*((d-y)/c)));s.style.cssText="left:"+(100*(y-j.startBase)/c)+"%;top:"+p+"px; width:"+q+"%;"+(this.config.style.featureCss?this.config.style.featureCss:"");if(this.config.style.arrowheadClass){var v=document.createElement("div");var n=q/100*c*z;switch(r){case 1:case"+":if(n>this.plusArrowWidth*1.1){v.className="plus-"+this.config.style.arrowheadClass;v.style.cssText="position: absolute; right: 0px; top: 0px; z-index: 100;";s.appendChild(v)}break;case -1:case"-":if(n>this.minusArrowWidth*1.1){v.className="minus-"+this.config.style.arrowheadClass;v.style.cssText="position: absolute; left: 0px; top: 0px; z-index: 100;";s.appendChild(v)}break}}if(A&&(z>this.labelScale)){var x;var l=this.featureUrl(g);if(l){x=document.createElement("a");x.href=l;x.target=s.target}else{x=document.createElement("div")}for(t in this.eventHandlers){x["on"+t]=this.eventHandlers[t]}x.className="feature-label";x.appendChild(document.createTextNode(A));x.style.top=(p+this.glyphHeight)+"px";x.style.left=(100*(h-j.startBase)/c)+"%";s.label=x;x.feature=g;j.appendChild(x)}if(q>k){var f=g.get("subfeatures");if(f){for(var u=0;u<f.length;u++){this.renderSubfeature(g,s,f[u],y,d)}}}if(this.config.hooks.modify){this.config.hooks.modify(this,g,s)}if(Util.is_ie6){s.appendChild(document.createComment())}return s};FeatureTrack.prototype.featureUrl=function(b){var c=true;if(this.config.style.linkTemplate){var a=this.config.style.linkTemplate.replace(/\{([^}]+)\}/g,function(d,e){var f=b.get(e.toLowerCase());if(f!==undefined){return f}else{c=false}return 0});if(c){return a}}return undefined};FeatureTrack.prototype.renderSubfeature=function(k,f,b,j,a){var g=b.get("start");var h=b.get("end");var c=a-j;var d=document.createElement("div");if(this.config.style.subfeatureClasses){var e=b.get("type");d.className=this.config.style.subfeatureClasses[e]||this.config.style.className+"-"+e;switch(b.get("strand")){case 1:case"+":d.className+=" plus-"+d.className;break;case -1:case"-":d.className+=" minus-"+d.className;break}}if((h<=j)||(g>=a)){return}if(Util.is_ie6){d.appendChild(document.createComment())}d.style.cssText="left: "+(100*((g-j)/c))+"%;top: 0px;width: "+(100*((h-g)/c))+"%;";f.appendChild(d)};function StaticTrack(b,a,c){Track.call(this,b,b,true,function(){});this.labelClass=a;this.posHeight=c;this.height=c}StaticTrack.prototype=new Track("");StaticTrack.prototype.fillBlock=function(h,c,d,j,l,e,b,g,f){var k=document.createElement("div");var a=Util.addCommas(l+1);k.className=this.labelClass;k.style.left="-"+Number(a.length)/1.7+"ex";k.appendChild(document.createTextNode(a));c.appendChild(k);this.heightUpdate(this.posHeight,h)};function GridTrack(a){Track.call(this,a,a,true,function(){})}GridTrack.prototype=new Track("");GridTrack.prototype.fillBlock=function(g,b,c,h,j,d,a,f,e){this.renderGridlines(b,j,d);this.heightUpdate(100,g)};GridTrack.prototype.renderGridlines=function(a,j,c){var k=c-j;var g=!(k%20)?20:!(k%10)?10:!(k%5)?5:!(k%2)?2:0;var f=k==20?2:k>0?1:0;var e=function(n,l){var m=document.createElement("div");m.style.cssText="left: "+l+"%; width: 0px";m.className="gridline "+n;return m};for(var b=0;b<g;b++){var d=100/g*b;var h=d==0||(g==20&&b==10)?"gridline_major":"gridline_minor";a.appendChild(e(h,d))}};function ImageTrack(a,d,c){Track.call(this,a.label,a.key,false,c.changeCallback);if(!d.end){return}this.refSeq=d;this.trackPadding=c.trackPadding||0;this.config=a;var b=a.backendVersion==0?TiledImageStore.Fixed_v0:TiledImageStore.Fixed;this.store=new b({refSeq:d,urlTemplate:a.urlTemplate,baseUrl:a.baseUrl,track:this});dojo.connect(this.store,"loadSuccess",this,"loadSuccess");dojo.connect(this.store,"loadFail",this,"loadFail")}ImageTrack.prototype=new Track("");ImageTrack.prototype.load=function(){this.store.load()};ImageTrack.prototype.loadSuccess=function(b,a){this.empty=this.store.empty;this.setLoaded()};ImageTrack.prototype.setViewInfo=function(g,f,a,c,b,e,d){Track.prototype.setViewInfo.apply(this,arguments);this.setLabel(this.key)};ImageTrack.prototype.handleImageError=function(b){var a=b.currentTarget||b.srcElement;a.style.display="none";dojo.stopEvent(b)};ImageTrack.prototype.makeImageLoadHandler=function(a,d,e,b){var c=dojo.hitch(this,function(){this.imageHeight=a.height;a.style.height=a.height+"px";a.style.width=(100*(a.baseWidth/e))+"%";this.heightUpdate(a.height,d);if(b){b()}return true});if(!dojo.isIE){return c}else{return function(){window.setTimeout(c,250)}}};ImageTrack.prototype.fillBlock=function(k,b,d,l,n,f,a,j,h,m){var c=f-n;var e=this.store.getImages(a,n,f);var g;dojo.forEach(e,function(o){o.className="image-track";if(!(o.parentNode&&o.parentNode.parentNode)){o.style.position="absolute";o.style.left=(100*((o.startBase-n)/c))+"%";switch(this.config.align){case"top":o.style.top="0px";break;case"bottom":default:o.style.bottom=this.trackPadding+"px";break}b.appendChild(o)}var p=this.makeImageLoadHandler(o,k,c);if(o.complete){p()}else{dojo.connect(o,"onload",p)}},this)};ImageTrack.prototype.startZoom=function(b,c,a){if(this.empty){return}this.store.clearCache();this.store.getImages(b,c,a)};ImageTrack.prototype.endZoom=function(b,a){Track.prototype.clear.apply(this)};ImageTrack.prototype.clear=function(){Track.prototype.clear.apply(this);this.store.clearCache()};ImageTrack.prototype.transfer=function(d,a,c,j,k){if(!(d&&a)){return}var b=d.childNodes;var g=a.startBase;var f=a.endBase;var h;for(var e=0;e<b.length;e++){h=b[e];if("startBase" in h){if((h.startBase<f)&&((h.startBase+h.baseWidth)>g)){h.style.left=(100*((h.startBase-g)/(f-g)))+"%";a.appendChild(h)}else{this.store.unCacheImage(h)}}}};var ImageTrack;if(!ImageTrack){ImageTrack={}}ImageTrack.Wiggle=function(){ImageTrack.apply(this,arguments)};ImageTrack.Wiggle.prototype=new ImageTrack({},{},{});dojo.mixin(ImageTrack.Wiggle.prototype,Track.YScaleMixin);ImageTrack.Wiggle.prototype.updateStaticElements=function(a){ImageTrack.prototype.updateStaticElements.apply(this,arguments);this.updateYScaleFromViewDimensions(a)};ImageTrack.Wiggle.prototype.loadSuccess=function(){ImageTrack.prototype.loadSuccess.apply(this,arguments)};ImageTrack.Wiggle.prototype.makeImageLoadHandler=function(a,c,d,b){return ImageTrack.prototype.makeImageLoadHandler.call(this,a,c,d,dojo.hitch(this,function(){if(!this.yscale){this.makeWiggleYScale()}if(b){b()}}))};ImageTrack.Wiggle.prototype.makeWiggleYScale=function(){try{this.min=this.store.stats.global_min;this.max=this.store.stats.global_max}catch(a){return}this.makeYScale()};function Animation(a,d,c){if(a===undefined){return}if("animation" in a){a.animation.stop()}this.index=0;this.time=c;this.subject=a;this.callback=d;var b=this;this.animFunction=function(){b.animate()};this.animID=setTimeout(this.animFunction,33);this.frames=0;a.animation=this}Animation.prototype.animate=function(){if(this.finished){this.stop();return}var b=33;var a=0;if(!("startTime" in this)){this.startTime=(new Date()).getTime()}else{a=(new Date()).getTime()-this.startTime;b=Math.max(33,a/this.frames)}if(a<this.time){this.step(a/this.time);this.frames++}else{this.step(1);this.finished=true}this.animID=setTimeout(this.animFunction,b)};Animation.prototype.stop=function(){clearTimeout(this.animID);delete this.subject.animation;this.callback.call(this.subject,this)};function Slider(a,d,b,c){Animation.call(this,a,d,b);this.slideStart=a.getX();this.slideDistance=c}Slider.prototype=new Animation();Slider.prototype.step=function(b){var a=(this.slideStart-(this.slideDistance*((-0.5*Math.cos(b*Math.PI))+0.5)))|0;a=Math.max(Math.min(this.subject.maxLeft-this.subject.offset,a),this.subject.minLeft-this.subject.offset);this.subject.setX(a)};function Zoomer(f,b,g,e,d){Animation.call(this,b,g,e);this.toZoom=b.zoomContainer;var a=this.toZoom.clientWidth;this.initialWidth=a;this.width0=a*Math.min(1,f);var c=a*Math.max(1,f);this.distance=c-this.width0;this.zoomingIn=f>1;this.center=(b.getX()+(b.elem.clientWidth*d))/b.scrollContainer.clientWidth;this.initialX=this.subject.getX();this.initialLeft=parseInt(this.toZoom.style.left)}Zoomer.prototype=new Animation();Zoomer.prototype.step=function(e){var a=this.zoomingIn?e:1-e;var d=((a*a)*this.distance)+this.width0;var c=(this.center*this.initialWidth)-(this.center*d);this.toZoom.style.width=d+"px";this.toZoom.style.left=(this.initialLeft+c)+"px";var b=this.toZoom.offsetTop;this.subject.updateStaticElements({x:this.initialX-c})};function BehaviorManager(a){this.context=a.context;this.behaviors=a.behaviors}BehaviorManager.prototype.initialize=function(){this.removeAll();for(var c in this.behaviors){var a=this.behaviors[c];if(a.apply_on_init){this.applyBehaviors(c)}}};BehaviorManager.prototype.applyBehaviors=function(){dojo.forEach(arguments,function(c){var a=this._get(c);if(!a.applied){a.handles=a.handles||[];a.handles=a.apply.call(this.context||this,this,a.handles);a.applied=true}},this)};BehaviorManager.prototype._get=function(c){var a=this.behaviors[c];if(!a){throw"no behavior registed with name ''name"}return a};BehaviorManager.prototype.swapBehaviors=function(b,a){this.removeBehaviors(b);this.applyBehaviors(a)};BehaviorManager.prototype.removeBehaviors=function(){dojo.forEach(arguments,function(d){var c=this._get(d);if(c.applied){var a=c.remove||function(b,e){dojo.forEach(e,dojo.disconnect,dojo)};a.call(this.context||this,this,c.handles);c.applied=false}},this)};BehaviorManager.prototype.removeAll=function(){for(var a in this.behaviors){this.removeBehaviors(a)}};function GenomeView(e,a,h,f,c,d){this.browser=e;var k=this.calculateSequenceCharacterSize(a);this.charWidth=k.width;this.seqHeight=k.height;this.posHeight=this.calculatePositionLabelHeight(a);this.topSpace=1.5*this.posHeight;this.ref=f;this.pxPerBp=c;this.browserRoot=d?d:"";this.stripeWidth=h;this.elem=a;this.scrollContainer=dojo.create("div",{id:"container",style:{position:"absolute",left:"0px",top:"0px"}},a);this._renderVerticalScrollBar();this.zoomContainer=document.createElement("div");this.zoomContainer.id="zoomContainer";this.zoomContainer.style.cssText="position: absolute; left: 0px; top: 0px; height: 100%;";this.scrollContainer.appendChild(this.zoomContainer);this.outerTrackContainer=document.createElement("div");this.outerTrackContainer.className="trackContainer outerTrackContainer";this.outerTrackContainer.style.cssText="height: 100%;";this.zoomContainer.appendChild(this.outerTrackContainer);this.trackContainer=document.createElement("div");this.trackContainer.className="trackContainer innerTrackContainer draggable";this.trackContainer.style.cssText="height: 100%;";this.outerTrackContainer.appendChild(this.trackContainer);this.regularStripe=h;this.fullZoomStripe=this.charWidth*(h/10);this.overview=dojo.byId("overview");this.overviewBox=dojo.coords(this.overview);this.tracks=[];this.uiTracks=[];this.trackIndices={};this.sizeInit();this.offset=0;this.maxLeft=this.bpToPx(this.ref.end+1)-this.getWidth();this.minLeft=this.bpToPx(this.ref.start);this.trackPadding=20;this.drawMargin=0.2;this.slideTimeMultiple=0.8;this.trackHeights=[];this.trackTops=[];this.trackLabels=[];this.waitElems=dojo.filter([dojo.byId("moveLeft"),dojo.byId("moveRight"),dojo.byId("zoomIn"),dojo.byId("zoomOut"),dojo.byId("bigZoomIn"),dojo.byId("bigZoomOut"),document.body,a],function(l){return l});this.prevCursors=[];this.locationThumb=document.createElement("div");this.locationThumb.className="locationThumb";this.overview.appendChild(this.locationThumb);this.locationThumbMover=new dojo.dnd.move.parentConstrainedMoveable(this.locationThumb,{area:"margin",within:true});if(dojo.isIE){this.x=-parseInt(this.scrollContainer.style.left);this.y=-parseInt(this.scrollContainer.style.top);this.rawSetX=function(l){this.scrollContainer.style.left=-l+"px";this.x=l};this.rawSetY=function(l){this.scrollContainer.style.top=-l+"px";this.y=l}}else{this.x=this.elem.scrollLeft;this.y=this.elem.scrollTop;this.rawSetX=function(l){this.elem.scrollLeft=l;this.x=l};this.rawSetY=function(l){this.elem.scrollTop=l;this.y=l}}var b=document.createElement("div");b.className="track static_track rubberBandAvailable";b.style.height=this.posHeight+"px";b.id="static_track";this.scaleTrackDiv=b;this.staticTrack=new StaticTrack("static_track","pos-label",this.posHeight);this.staticTrack.setViewInfo(function(l){},this.stripeCount,this.scaleTrackDiv,undefined,this.stripePercent,this.stripeWidth,this.pxPerBp,this.trackPadding);this.zoomContainer.appendChild(this.scaleTrackDiv);this.waitElems.push(this.scaleTrackDiv);var j=document.createElement("div");j.className="track";j.style.cssText="top: 0px; height: 100%;";j.id="gridtrack";var g=new GridTrack("gridtrack");g.setViewInfo(function(l){},this.stripeCount,j,undefined,this.stripePercent,this.stripeWidth,this.pxPerBp,this.trackPadding);this.trackContainer.appendChild(j);this.uiTracks=[this.staticTrack,g];this.trackDndWidget=new dojo.dnd.Source(this.trackContainer,{accept:["track"],withHandles:true,creator:dojo.hitch(this,function(l,m){return{data:l,type:["track"],node:m=="avatar"?dojo.create("div",{innerHTML:l.key||l.label,className:"track-label dragging"}):this.renderTrack(l)}})});this.browser.subscribe("/dnd/drop",this,function(m,l,p,o){this.updateTrackList();if(o.node===this.trackContainer){var n=dojo.filter(dojo.map(l,function(q){return q.track&&q.track.config}),function(q){return q});this.browser.publish("/jbrowse/v1/v/tracks/show",[n])}});this.browser.subscribe("/jbrowse/v1/c/tracks/show",this,"showTracks");this.browser.subscribe("/jbrowse/v1/c/tracks/hide",this,"hideTracks");dojo.forEach(this.uiTracks,function(l){l.showRange(0,this.stripeCount-1,Math.round(this.pxToBp(this.offset)),Math.round(this.stripeWidth/this.pxPerBp),this.pxPerBp)},this);this.zoomContainer.style.paddingTop=this.topSpace+"px";this.addOverviewTrack(new StaticTrack("overview_loc_track","overview-pos",this.overviewPosHeight));this.showFine();this.showCoarse();this.behaviorManager=new BehaviorManager({context:this,behaviors:this._behaviors()});this.behaviorManager.initialize()}GenomeView.prototype._renderVerticalScrollBar=function(){var a=dojo.create("div",{className:"vertical_scrollbar",style:{position:"fixed",right:"0px",bottom:"0px",height:"100%",zIndex:1000}},this.elem);var b=dojo.create("div",{className:"vertical_position_marker",style:{position:"absolute",height:"100%"}},a);this.verticalScrollBar={container:a,positionMarker:b}};GenomeView.prototype._updateVerticalScrollBar=function(c){if(typeof c.height=="number"){var b=this.staticTrack?-this.staticTrack.div.offsetHeight:0;var d=c.height+b;this.verticalScrollBar.container.style.height=d+"px";var a=c.height/this.containerHeight*100;this.verticalScrollBar.positionMarker.style.height=a>0.5?a+"%":"1px";this.verticalScrollBar.container.style.display=c.height/this.containerHeight>0.98?"none":"block"}if(typeof c.y=="number"||typeof c.height=="number"){this.verticalScrollBar.positionMarker.style.top=((c.y||this.getY())/this.containerHeight*100)+"%"}};GenomeView.prototype.visibleTracks=function(){return this.tracks};GenomeView.prototype._behaviors=function(){return{always:{apply_on_init:true,apply:function(){var a=[];this.overviewTrackIterate(function(b){a.push(dojo.connect(b.div,"mousedown",dojo.hitch(this,"startRubberZoom",this.overview_absXtoBp,b.div)))});a.push(dojo.connect(this.scrollContainer,"mousewheel",this,"wheelScroll",false),dojo.connect(this.scrollContainer,"DOMMouseScroll",this,"wheelScroll",false),dojo.connect(this.scaleTrackDiv,"mousedown",dojo.hitch(this,"startRubberZoom",this.absXtoBp,this.scrollContainer)),dojo.connect(this.outerTrackContainer,"dblclick",this,"doubleClickZoom"),dojo.connect(this.locationThumbMover,"onMoveStop",this,"thumbMoved"),dojo.connect(this.overview,"onclick",this,"overviewClicked"),dojo.connect(this.scaleTrackDiv,"onclick",this,"scaleClicked"),dojo.connect(document.body,"onmouseleave",this,function(){this.behaviorManager.swapBehaviors("shiftMouse","normalMouse")}),dojo.connect(document.body,"onmouseenter",this,function(b){if(b.shiftKey){this.behaviorManager.swapBehaviors("normalMouse","shiftMouse")}}),dojo.connect(window,"onkeyup",this,function(b){if(b.keyCode==dojo.keys.SHIFT){this.behaviorManager.swapBehaviors("shiftMouse","normalMouse")}}),dojo.connect(window,"onkeydown",this,function(b){if(b.keyCode==dojo.keys.SHIFT){this.behaviorManager.swapBehaviors("normalMouse","shiftMouse")}}));return a}},normalMouse:{apply_on_init:true,apply:function(){return[dojo.connect(this.outerTrackContainer,"mousedown",this,"startMouseDragScroll")]}},shiftMouse:{apply:function(){dojo.removeClass(this.trackContainer,"draggable");dojo.addClass(this.trackContainer,"rubberBandAvailable");return[dojo.connect(this.outerTrackContainer,"mousedown",dojo.hitch(this,"startRubberZoom",this.absXtoBp,this.scrollContainer)),dojo.connect(this.outerTrackContainer,"onclick",this,"scaleClicked")]},remove:function(b,a){dojo.forEach(a,dojo.disconnect,dojo);dojo.removeClass(this.trackContainer,"rubberBandAvailable");dojo.addClass(this.trackContainer,"draggable")}},mouseDragScrolling:{apply:function(){return[dojo.connect(document.body,"mouseup",this,"dragEnd"),dojo.connect(document.body,"mousemove",this,"dragMove"),dojo.connect(document.body,"mouseout",this,"checkDragOut")]}},mouseRubberBandZooming:{apply:function(){return[dojo.connect(document.body,"mouseup",this,"rubberExecute"),dojo.connect(document.body,"mousemove",this,"rubberMove"),dojo.connect(document.body,"mouseout",this,"rubberCancel"),dojo.connect(window,"onkeydown",this,"rubberCancel")]}}}};GenomeView.prototype.calculateSequenceCharacterSize=function(d){var c=document.createElement("div");c.className="sequence";c.style.visibility="hidden";var b="12345678901234567890123456789012345678901234567890";c.appendChild(document.createTextNode(b));d.appendChild(c);var a={width:c.clientWidth/b.length,height:c.clientHeight};d.removeChild(c);return a};GenomeView.prototype.calculatePositionLabelHeight=function(c){var b=document.createElement("div");b.className="pos-label";b.style.visibility="hidden";b.appendChild(document.createTextNode("42"));c.appendChild(b);var a=b.clientHeight;c.removeChild(b);return a};GenomeView.prototype.wheelScroll=function(a){this.setY(this.getY()-60*Util.wheel(a));if(this.wheelScrollTimeout){window.clearTimeout(this.wheelScrollTimeout)}this.wheelScrollTimeout=window.setTimeout(dojo.hitch(this,function(){this.showVisibleBlocks(true);this.wheelScrollTimeout=null},100));dojo.stopEvent(a)};GenomeView.prototype.getX=function(){return this.x};GenomeView.prototype.getY=function(){return this.y};GenomeView.prototype.getHeight=function(){return this.elem.offsetHeight};GenomeView.prototype.getWidth=function(){return this.elem.offsetWidth};GenomeView.prototype.clampX=function(a){return Math.round(Math.max(Math.min(this.maxLeft-this.offset,a||0),this.minLeft-this.offset))};GenomeView.prototype.clampY=function(a){return Math.round(Math.min(Math.max(0,a||0),this.containerHeight-this.getHeight()))};GenomeView.prototype.setX=function(a){a=this.clampX(a);this.rawSetX(a);this.updateStaticElements({x:a});this.showFine();return a};GenomeView.prototype.setY=function(a){a=this.clampY(a);this.rawSetY(a);this.updateStaticElements({y:a});return a};GenomeView.prototype.rawSetPosition=function(a){this.rawSetX(a.x);this.rawSetY(a.y);return a};GenomeView.prototype.setPosition=function(c){var a=this.clampX(c.x);var b=this.clampY(c.y);this.updateStaticElements({x:a,y:b});this.rawSetX(a);this.rawSetY(b);this.showFine()};GenomeView.prototype.getPosition=function(){return{x:this.x,y:this.y}};GenomeView.prototype.zoomCallback=function(){this.zoomUpdate()};GenomeView.prototype.afterSlide=function(){this.showCoarse();this.scrollUpdate();this.showVisibleBlocks(true)};GenomeView.prototype.doubleClickZoom=function(a){if(this.dragging){return}if("animation" in this){return}if(this.scaleClickedTimeout){window.clearTimeout(this.scaleClickedTimeout)}var b=(a.pageX-dojo.coords(this.elem,true).x)/this.getWidth();if(a.shiftKey){this.zoomOut(a,b,2)}else{this.zoomIn(a,b,2)}dojo.stopEvent(a)};GenomeView.prototype._beforeMouseDrag=function(a){if(this.animation){if(this.animation instanceof Zoomer){dojo.stopEvent(a);return 0}else{this.animation.stop()}}if(Util.isRightButton(a)){return 0}dojo.stopEvent(a);return 1};GenomeView.prototype.startMouseDragScroll=function(a){if(!this._beforeMouseDrag(a)){return}this.behaviorManager.applyBehaviors("mouseDragScrolling");this.dragging=true;this.dragStartPos={x:a.clientX,y:a.clientY};this.winStartPos=this.getPosition()};GenomeView.prototype.startRubberZoom=function(b,a,c){if(!this._beforeMouseDrag(c)){return}this.behaviorManager.applyBehaviors("mouseRubberBandZooming");this.rubberbanding={absFunc:b,container:a};this.rubberbandStartPos={x:c.clientX,y:c.clientY};this.winStartPos=this.getPosition()};GenomeView.prototype._rubberStop=function(a){this.behaviorManager.removeBehaviors("mouseRubberBandZooming");this.hideRubberHighlight();dojo.stopEvent(a)};GenomeView.prototype.rubberCancel=function(b){var c=document.body.parentNode;var a=document.body;if(!b||!(b.relatedTarget||b.toElement)||(c===(b.relatedTarget||b.toElement))||(a===(b.relatedTarget||b.toElement))){this._rubberStop(b)}};GenomeView.prototype.rubberMove=function(a){this.setRubberHighlight(this.rubberbandStartPos,{x:a.clientX,y:a.clientY})};GenomeView.prototype.rubberExecute=function(b){this._rubberStop(b);var e=this.rubberbandStartPos;var a={x:b.clientX,y:b.clientY};if(Math.abs(e.x-a.x)<3){return this._rubberStop(b)}var d=this.rubberbanding.absFunc.call(this,Math.min(e.x,a.x));var c=this.rubberbanding.absFunc.call(this,Math.max(e.x,a.x));delete this.rubberbanding;this.setLocation(this.ref,d,c)};GenomeView.prototype.setRubberHighlight=function(e,b){var a=this.rubberbanding.container,d=dojo.coords(a,true);var c=this.rubberHighlight||(function(){var f=this.rubberHighlight=document.createElement("div");f.className="rubber-highlight";f.style.position="absolute";f.style.zIndex=1000;var g=document.createElement("div");g.appendChild(document.createTextNode("Zoom to region"));f.appendChild(g);g.style.position="relative";g.style.top=(50-d.y)+"px";a.appendChild(f);return f}).call(this);c.style.visibility="visible";c.style.left=Math.min(e.x,b.x)-d.x+"px";c.style.width=Math.abs(b.x-e.x)+"px"};GenomeView.prototype.dragEnd=function(a){this.behaviorManager.removeBehaviors("mouseDragScrolling");this.dragging=false;dojo.stopEvent(a);this.showCoarse();this.scrollUpdate();this.showVisibleBlocks(true)};GenomeView.prototype.checkDragOut=function(b){var c=document.body.parentNode;var a=document.body;if(!(b.relatedTarget||b.toElement)||(c===(b.relatedTarget||b.toElement))||(a===(b.relatedTarget||b.toElement))){this.dragEnd(b)}};GenomeView.prototype.dragMove=function(a){this.setPosition({x:this.winStartPos.x-(a.clientX-this.dragStartPos.x),y:this.winStartPos.y-(a.clientY-this.dragStartPos.y)});dojo.stopEvent(a)};GenomeView.prototype.hideRubberHighlight=function(b,a){if(this.rubberHighlight){this.rubberHighlight.parentNode.removeChild(this.rubberHighlight);delete this.rubberHighlight}};GenomeView.prototype.slide=function(a){if(this.animation){this.animation.stop()}this.trimVertical();new Slider(this,this.afterSlide,Math.abs(a)*this.getWidth()*this.slideTimeMultiple+200,a*this.getWidth())};GenomeView.prototype.setLocation=function(c,d,b){if(d===undefined){d=this.minVisible()}if(b===undefined){b=this.maxVisible()}if((d<c.start)||(d>c.end)){d=c.start}if((b<c.start)||(b>c.end)){b=c.end}if(this.ref!=c){this.ref=c;var a=function(e){if(e.div&&e.div.parentNode){e.div.parentNode.removeChild(e.div)}};dojo.forEach(this.tracks,a);this.tracks=[];this.trackIndices={};this.trackHeights=[];this.trackTops=[];this.trackLabels=[];dojo.forEach(this.uiTracks,function(e){e.clear()});this.overviewTrackIterate(a);this.addOverviewTrack(new StaticTrack("overview_loc_track","overview-pos",this.overviewPosHeight));this.sizeInit();this.setY(0);this.behaviorManager.initialize()}this.pxPerBp=Math.min(this.getWidth()/(b-d),this.charWidth);this.curZoom=Util.findNearest(this.zoomLevels,this.pxPerBp);if(Math.abs(this.pxPerBp-this.zoomLevels[this.zoomLevels.length-1])<0.2){console.log("nudging zoom level from %d to %d",this.pxPerBp,this.zoomLevels[this.zoomLevels.length-1]);this.pxPerBp=this.zoomLevels[this.zoomLevels.length-1]}this.stripeWidth=(this.stripeWidthForZoom(this.curZoom)/this.zoomLevels[this.curZoom])*this.pxPerBp;this.instantZoomUpdate();this.centerAtBase((d+b)/2,true)};GenomeView.prototype.stripeWidthForZoom=function(a){if((this.zoomLevels.length-1)==a){return this.fullZoomStripe}else{if(0==a){return this.minZoomStripe}else{return this.regularStripe}}};GenomeView.prototype.instantZoomUpdate=function(){this.scrollContainer.style.width=(this.stripeCount*this.stripeWidth)+"px";this.zoomContainer.style.width=(this.stripeCount*this.stripeWidth)+"px";this.maxOffset=this.bpToPx(this.ref.end)-this.stripeCount*this.stripeWidth;this.maxLeft=this.bpToPx(this.ref.end+1)-this.getWidth();this.minLeft=this.bpToPx(this.ref.start)};GenomeView.prototype.centerAtBase=function(d,b){d=Math.min(Math.max(d,this.ref.start),this.ref.end);if(b){var k=this.bpToPx(d);var j=this.stripeCount*this.stripeWidth;var h=Math.floor((k-(j/2))/this.stripeWidth);this.offset=h*this.stripeWidth;this.setX(k-this.offset-(this.getWidth()/2));this.trackIterate(function(l){l.clear()});this.showVisibleBlocks(true);this.showCoarse()}else{var e=this.pxToBp(this.x+this.offset);var g=(this.getWidth()/this.pxPerBp)/2;var f=e+g+g;var a=e+g;if((d>=(e-g))&&(d<=(f+g))){if(this.animation){this.animation.stop()}var c=(a-d)*this.pxPerBp;this.trimVertical();new Slider(this,this.afterSlide,Math.abs(c)*this.slideTimeMultiple+200,c)}else{this.centerAtBase(d,true)}}};GenomeView.prototype.minVisible=function(){var a=this.pxToBp(this.x+this.offset);if(a<this.pxToBp(1)){return 0}else{return a}};GenomeView.prototype.maxVisible=function(){var a=this.pxToBp(this.x+this.offset+this.getWidth());if(a>this.ref.end-this.pxToBp(1)){return this.ref.end}else{return a}};GenomeView.prototype.showFine=function(){this.onFineMove(this.minVisible(),this.maxVisible())};GenomeView.prototype.showCoarse=function(){this.onCoarseMove(this.minVisible(),this.maxVisible())};GenomeView.prototype.onFineMove=function(b,a){};GenomeView.prototype.onCoarseMove=function(b,a){};GenomeView.prototype.onResize=function(){this.sizeInit();this.showVisibleBlocks();this.showFine();this.showCoarse()};GenomeView.prototype.overviewClicked=function(a){this.centerAtBase(this.overview_absXtoBp(a.clientX))};GenomeView.prototype.overview_absXtoBp=function(a){return(a-this.overviewBox.x)/this.overviewBox.w*(this.ref.end-this.ref.start)+this.ref.start};GenomeView.prototype.scaleClicked=function(a){var b=this.absXtoBp(a.clientX);this.scaleClickedTimeout=window.setTimeout(dojo.hitch(this,function(){this.centerAtBase(b)},100))};GenomeView.prototype.thumbMoved=function(b){var d=parseInt(this.locationThumb.style.left);var a=parseInt(this.locationThumb.style.width);var c=d+(a/2);this.centerAtBase(((c/this.overviewBox.w)*(this.ref.end-this.ref.start))+this.ref.start)};GenomeView.prototype.checkY=function(a){return Math.min((a<0?0:a),this.containerHeight-this.getHeight())};GenomeView.prototype.updateStaticElements=function(a){this.trackIterate(function(b){b.updateStaticElements(a)},this);this._updateVerticalScrollBar(a);if(typeof a.x=="number"){dojo.forEach(this.trackLabels,function(b){b.style.left=a.x+"px"})}if(typeof a.y=="number"){this.staticTrack.div.style.top=a.y+"px"}};GenomeView.prototype.showWait=function(){var b=[];for(var a=0;a<this.waitElems.length;a++){b[a]=this.waitElems[a].style.cursor;this.waitElems[a].style.cursor="wait"}this.prevCursors.push(b)};GenomeView.prototype.showDone=function(){var b=this.prevCursors.pop();for(var a=0;a<this.waitElems.length;a++){this.waitElems[a].style.cursor=b[a]}};GenomeView.prototype.pxToBp=function(a){return a/this.pxPerBp};GenomeView.prototype.absXtoBp=function(a){return this.pxToBp(this.getPosition().x+this.offset-dojo.coords(this.elem,true).x+a)};GenomeView.prototype.bpToPx=function(a){return a*this.pxPerBp};GenomeView.prototype.sizeInit=function(){this.overviewBox=dojo.coords(this.overview);this.zoomLevels=[1/500000,1/200000,1/100000,1/50000,1/20000,1/10000,1/5000,1/2000,1/1000,1/500,1/200,1/100,1/50,1/20,1/10,1/5,1/2,1,2,5,this.charWidth];while(((this.ref.end-this.ref.start)*this.zoomLevels[0])<this.getWidth()){this.zoomLevels.shift()}this.zoomLevels.unshift(this.getWidth()/(this.ref.end-this.ref.start));this.minZoomStripe=this.regularStripe*(this.zoomLevels[0]/this.zoomLevels[1]);this.curZoom=0;while(this.pxPerBp>this.zoomLevels[this.curZoom]){this.curZoom++}this.maxLeft=this.bpToPx(this.ref.end+1)-this.getWidth();delete this.stripePercent;var k=[20,10,5,4,2,1];for(var j=0;j<k.length;j++){if(((100/k[j])*(this.regularStripe*0.7))>((this.getWidth()*3)+this.regularStripe)){this.stripePercent=k[j];break}}if(this.stripePercent===undefined){console.warn("stripeWidth too small: "+this.stripeWidth+", "+this.getWidth());this.stripePercent=1}var p;var l=this.stripeCount;if(l){p=this.getX()}this.stripeCount=Math.round(100/this.stripePercent);this.scrollContainer.style.width=(this.stripeCount*this.stripeWidth)+"px";this.zoomContainer.style.width=(this.stripeCount*this.stripeWidth)+"px";var f=undefined;if(l&&(l!=this.stripeCount)){f=Math.floor((l-this.stripeCount)/2);var m=(f*this.stripeWidth);var a=this.getX()-m;this.offset+=m;this.updateStaticElements({x:a});this.rawSetX(a)}this.trackIterate(function(q,n){q.sizeInit(n.stripeCount,n.stripePercent,f)});var b=this.trackHeights&&this.trackHeights.length?Math.max(dojof.reduce(this.trackHeights,"+")+this.trackPadding*this.trackHeights.length,this.getHeight()):this.getHeight();this.scrollContainer.style.height=b+"px";this.containerHeight=b;var o=this.ref.end-this.ref.start;var c=document.createElement("div");c.className="overview-pos";c.appendChild(document.createTextNode(Util.addCommas(this.ref.end)));c.style.visibility="hidden";this.overview.appendChild(c);var d=c.clientWidth*1.2;this.overviewPosHeight=c.clientHeight;this.overview.removeChild(c);for(var e=1;e<30;e++){this.overviewStripeBases=(Math.pow(e%3,2)+1)*Math.pow(10,Math.floor(e/3));this.overviewStripes=Math.ceil(o/this.overviewStripeBases);if((this.overviewBox.w/this.overviewStripes)>d){break}if(this.overviewStripes<2){break}}var h=100/(o/this.overviewStripeBases);var g=0;this.overviewTrackIterate(function(q,n){q.clear();q.sizeInit(n.overviewStripes,h);q.showRange(0,n.overviewStripes-1,-1,n.overviewStripeBases,n.overviewBox.w/(n.ref.end-n.ref.start))});this.updateOverviewHeight();this.updateScroll()};GenomeView.prototype.updateScroll=function(){var a={height:this.getHeight()};if(this.getY()>0){if(this.containerHeight-this.getY()<a.height){a.y=this.setY(Math.max(0,this.containerHeight-a.height))}}this.updateStaticElements(a)};GenomeView.prototype.overviewTrackIterate=function(b){var a=this.overview.firstChild;do{if(a&&a.track){b.call(this,a.track,this)}}while(a&&(a=a.nextSibling))};GenomeView.prototype.updateOverviewHeight=function(b,a){var c=0;this.overviewTrackIterate(function(e,d){c+=e.height});this.overview.style.height=c+"px";this.overviewBox=dojo.coords(this.overview)};GenomeView.prototype.addOverviewTrack=function(d){var c=this.ref.end-this.ref.start;var e=100/(c/this.overviewStripeBases);var a=document.createElement("div");a.className="track";a.style.height=this.overviewBox.h+"px";a.style.left=(((-this.ref.start)/c)*this.overviewBox.w)+"px";a.id="overviewtrack_"+d.name;a.track=d;var b=this;var f=function(g){b.updateOverviewHeight()};d.setViewInfo(f,this.overviewStripes,a,undefined,e,this.overviewStripeBases,this.pxPerBp,this.trackPadding);this.overview.appendChild(a);this.updateOverviewHeight();return a};GenomeView.prototype.trimVertical=function(e){if(e===undefined){e=this.getY()}var c;var d=this.topSpace;var a=e+this.getHeight();for(var b=0;b<this.tracks.length;b++){if(this.tracks[b].shown){c=d+this.trackHeights[b];if(!((c>e)&&(d<a))){this.tracks[b].hideAll()}d=c+this.trackPadding}}};GenomeView.prototype.zoomIn=function(f,d,c){if(this.animation){return}if(d===undefined){d=0.5}if(c===undefined){c=1}c=Math.min(c,(this.zoomLevels.length-1)-this.curZoom);if((0==c)&&(this.pxPerBp==this.zoomLevels[this.curZoom])){return}this.showWait();var h=this.getPosition();this.trimVertical(h.y);var g=this.zoomLevels[this.curZoom+c]/this.pxPerBp;var b=this.pxToBp(h.x+this.offset+(d*this.getWidth()));this.curZoom+=c;this.pxPerBp=this.zoomLevels[this.curZoom];this.maxLeft=this.bpToPx(this.ref.end+1)-this.getWidth();for(var a=0;a<this.tracks.length;a++){this.tracks[a].startZoom(this.pxPerBp,b-((d*this.getWidth())/this.pxPerBp),b+(((1-d)*this.getWidth())/this.pxPerBp))}new Zoomer(g,this,function(){this.zoomUpdate(d,b)},700,d)};GenomeView.prototype.zoomOut=function(g,f,c){if(this.animation){return}if(c===undefined){c=1}c=Math.min(c,this.curZoom);if(0==c){return}this.showWait();var j=this.getPosition();this.trimVertical(j.y);if(f===undefined){f=0.5}var h=this.zoomLevels[this.curZoom-c]/this.pxPerBp;var d=this.bpToPx(this.ref.end)-(this.offset+j.x+this.getWidth());f=Math.max(f,1-(((d*h)/(1-h))/this.getWidth()));d=j.x+this.offset-this.bpToPx(this.ref.start);f=Math.min(f,((d*h)/(1-h))/this.getWidth());var b=this.pxToBp(j.x+this.offset+(f*this.getWidth()));this.curZoom-=c;this.pxPerBp=this.zoomLevels[this.curZoom];for(var a=0;a<this.tracks.length;a++){this.tracks[a].startZoom(this.pxPerBp,b-((f*this.getWidth())/this.pxPerBp),b+(((1-f)*this.getWidth())/this.pxPerBp))}this.minLeft=this.pxPerBp*this.ref.start;new Zoomer(h,this,function(){this.zoomUpdate(f,b)},700,f)};GenomeView.prototype.zoomUpdate=function(g,e){var b=this.elem.clientWidth;var f=this.bpToPx(e)-(g*b)+(b/2);this.stripeWidth=this.stripeWidthForZoom(this.curZoom);this.scrollContainer.style.width=(this.stripeCount*this.stripeWidth)+"px";this.zoomContainer.style.width=(this.stripeCount*this.stripeWidth)+"px";var a=Math.round(f/this.stripeWidth);var d=(a-((this.stripeCount)/2))|0;this.offset=d*this.stripeWidth;this.maxOffset=this.bpToPx(this.ref.end+1)-this.stripeCount*this.stripeWidth;this.maxLeft=this.bpToPx(this.ref.end+1)-this.getWidth();this.minLeft=this.bpToPx(this.ref.start);this.zoomContainer.style.left="0px";this.setX((f-this.offset)-(b/2));dojo.forEach(this.uiTracks,function(h){h.clear()});for(var c=0;c<this.tracks.length;c++){this.tracks[c].endZoom(this.pxPerBp,Math.round(this.stripeWidth/this.pxPerBp))}this.showVisibleBlocks(true);this.showDone();this.showCoarse()};GenomeView.prototype.scrollUpdate=function(){var g=this.getX();var e=this.stripeCount;var b=e*this.stripeWidth;var h=this.getWidth();var k=(b/2)-((h/2)+g);var f=(k/this.stripeWidth)|0;if(0==f){return}var j=Math.abs(f);var d=this.offset-(f*this.stripeWidth);if(this.offset==d){return}this.offset=d;this.trackIterate(function(l){l.moveBlocks(f)});var a=g+(f*this.stripeWidth);this.updateStaticElements({x:a});this.rawSetX(a);var c=(a/this.stripeWidth)|0};GenomeView.prototype.trackHeightUpdate=function(e,a){var f=this.getY();if(!(e in this.trackIndices)){return}var b=this.trackIndices[e];if(Math.abs(a-this.trackHeights[b])<1){return}if((((this.trackTops[b]+this.trackHeights[b])-f)<(this.getHeight()/2))&&(f>0)){this.setY(f+(a-this.trackHeights[b]))}this.trackHeights[b]=a;this.tracks[b].div.style.height=(a+this.trackPadding)+"px";var d=this.trackTops[b];if(this.tracks[b].shown){d+=a+this.trackPadding}for(var c=b+1;c<this.tracks.length;c++){this.trackTops[c]=d;this.tracks[c].div.style.top=d+"px";if(this.tracks[c].shown){d+=this.trackHeights[c]+this.trackPadding}}this.containerHeight=Math.max(d||0,this.getY()+this.getHeight());this.scrollContainer.style.height=this.containerHeight+"px";this.updateStaticElements({height:this.getHeight()})};GenomeView.prototype.showVisibleBlocks=function(d,f,e,j){if(f===undefined){f=this.getPosition()}if(e===undefined){e=f.x-(this.drawMargin*this.getWidth())}if(j===undefined){j=f.x+((1+this.drawMargin)*this.getWidth())}var c=Math.max(0,(e/this.stripeWidth)|0);var h=Math.min(this.stripeCount-1,(j/this.stripeWidth)|0);var b=Math.round(this.stripeWidth/this.pxPerBp);var a=Math.round(this.pxToBp((c*this.stripeWidth)+this.offset));a-=1;var g=Math.round(this.pxToBp(this.offset));var k=Math.round(this.pxToBp(this.offset+(this.stripeCount*this.stripeWidth)));this.trackIterate(function(m,l){m.showRange(c,h,a,b,l.pxPerBp,g,k)})};GenomeView.prototype.showTracks=function(b){var a=dojo.filter(b,function(c){return this._getTracks([c.label]).length==0},this);if(!a.length){return}this.trackDndWidget.insertNodes(false,a);this.updateTrackList()};GenomeView.prototype.hideTracks=function(b){var a=dojo.filter(b,function(c){return this._getTracks([c.label]).length!=0},this);if(!a.length){return}dojo.forEach(a,function(c){this.trackDndWidget.forInItems(function(f,g,e){if(c.label===f.data.label){this.trackDndWidget.delItem(g);var d=dojo.byId(g);if(d&&d.parentNode){d.parentNode.removeChild(d)}}},this)},this);this.updateTrackList()};GenomeView.prototype._getTracks=function(c){var b=[],a={count:c.length};dojo.forEach(c,function(d){a[d]=1});dojo.some(this.tracks,function(d){if(a[d.name]){b.push(d);a.count--}return !a.count},this);return b};GenomeView.prototype.renderTrack=function(trackConfig){if(!trackConfig){return null}var existingTrack;if(dojo.some(this.tracks,function(t){if(t.name==trackConfig.label){existingTrack=t;return true}return false})){return existingTrack.div}var class_=eval(trackConfig.type),track=new class_(trackConfig,this.ref,{changeCallback:dojo.hitch(this,"showVisibleBlocks",true),trackPadding:this.trackPadding,charWidth:this.charWidth,seqHeight:this.seqHeight});track.load();var trackDiv=dojo.create("div",{className:"track track_"+track.name,id:"track_"+track.name});trackDiv.trackName=track.name;trackDiv.track=track;var labelDiv=dojo.create("div",{className:"track-label dojoDndHandle",id:"label_"+track.name,style:{position:"absolute",top:0,left:this.getX()+"px"}},trackDiv);var closeButton=dojo.create("div",{className:"track-close-button",onclick:dojo.hitch(this,function(evt){this.browser.publish("/jbrowse/v1/v/tracks/hide",[[trackConfig]]);evt.stopPropagation()})},labelDiv);var labelText=dojo.create("span",{className:"track-label-text"},labelDiv);this.trackLabels.push(labelDiv);var heightUpdate=dojo.hitch(this,"trackHeightUpdate",track.name);track.setViewInfo(heightUpdate,this.stripeCount,trackDiv,labelDiv,this.stripePercent,this.stripeWidth,this.pxPerBp,this.trackPadding);track.updateStaticElements({x:this.getX(),y:this.getY(),height:this.getHeight(),width:this.getWidth()});this.updateTrackList();return trackDiv};GenomeView.prototype.trackIterate=function(b){var a;for(a=0;a<this.uiTracks.length;a++){b(this.uiTracks[a],this)}for(a=0;a<this.tracks.length;a++){b(this.tracks[a],this)}};GenomeView.prototype.updateTrackList=function(){var c=[];var a=this.trackContainer.firstChild;do{if(a.track){c.push(a.track)}}while((a=a.nextSibling));this.tracks=c;var g={};var b=new Array(this.tracks.length);var f=0;for(var e=0;e<c.length;e++){g[c[e].name]=e;if(c[e].name in this.trackIndices){b[e]=this.trackHeights[this.trackIndices[c[e].name]]}else{b[e]=0}f+=b[e];this.trackIndices[c[e].name]=e}this.trackIndices=g;this.trackHeights=b;var d=this.topSpace;for(var e=0;e<this.tracks.length;e++){this.trackTops[e]=d;this.tracks[e].div.style.top=d+"px";if(this.tracks[e].shown){d+=this.trackHeights[e]+this.trackPadding}}this.containerHeight=Math.max(d||0,this.getHeight());this.scrollContainer.style.height=this.containerHeight+"px";this.updateScroll()};function CompareObjPos(b,g){var d=0,c=0,f=g.pageY;for(var e=0;e<b.length;e++){d=c++;var a=findPos(b[e]);if(a.top>f){break}}return d}function checkAvatarPosition(c){var a=document.getElementById("tracksAvail"),b=document.getElementById("container");if(c.pageX<(a.offsetLeft+a.offsetWidth)){return a}else{return b}}var startX;function removeTouchEvents(){startX=null}function touchSimulated(b){if(b.touches.length<=1){var n=b.changedTouches,m=n[0],k="",f="mouseover",p=document.getElementsByClassName("dojoDndAvatar"),j={},c=checkAvatarPosition(m),a=c.getElementsByClassName("dojoDndItem"),h={},o=document.createEvent("MouseEvent"),l=document.createEvent("MouseEvent");switch(b.type){case"touchstart":startX=m.pageX;k="mousedown";break;case"touchmove":b.preventDefault();k="mousemove";break;default:return}o.initMouseEvent(k,true,true,window,1,m.pageX,m.pageY,m.clientX,m.clientY,false,false,false,false,0,null);l.initMouseEvent(f,true,true,window,1,m.pageX,m.pageY,m.clientX,m.clientY,false,false,false,false,0,null);switch(b.type){case"touchstart":m.target.dispatchEvent(o);m.target.dispatchEvent(l);initialPane=c;break;case"touchmove":if(p.length>0){if(a.length>0){h=CompareObjPos(a,m);j=a[h]}try{if(initialPane!=c){var g=document.createEvent("MouseEvent");var e="mouseout";g.initMouseEvent(e,true,true,window,1,m.pageX,m.pageY,m.clientX,m.clientY,false,false,false,false,0,null);initialPane.dispatchEvent(g)}j.dispatchEvent(l);j.dispatchEvent(o)}catch(d){c.dispatchEvent(l);c.dispatchEvent(o)}}break;default:return}}else{removeTouchEvents()}}function touchEnd(b){var k=b.changedTouches,j=k[0],g="mouseup",d="mouseover",o=document.getElementsByClassName("dojoDndAvatar"),f={},c=checkAvatarPosition(j),a=c.getElementsByClassName("dojoDndItem"),e={},l=document.createEvent("MouseEvent"),h=document.createEvent("MouseEvent");if(startX!==j.pageX){b.preventDefault()}var m=findPos(j.target);l.initMouseEvent(g,true,true,window,1,j.pageX,j.pageY,j.clientX,j.clientY,false,false,false,false,0,null);h.initMouseEvent(d,true,true,window,1,j.pageX,j.pageY,j.clientX,j.clientY,false,false,false,false,0,null);if(o.length>0){if(a.length>0){e=CompareObjPos(a,j);f=a[e]}try{f.dispatchEvent(h);f.dispatchEvent(l)}catch(n){j.target.dispatchEvent(h);c.dispatchEvent(h)}}else{j.target.dispatchEvent(l);j.target.dispatchEvent(h)}removeTouchEvents()}function touchHandle(c){dojo.query(".dojoDndItemAnchor").connect("touchstart",touchSimulated);dojo.query(".dojoDndItemAnchor").connect("touchmove",touchSimulated);dojo.query(".dojoDndItemAnchor").connect("touchend",touchEnd);dojo.query(".dojoDndItemAnchor").connect("click",function(){void (0)});if(c.touches.length<=1){var d=c.changedTouches,e=d[0],a="";switch(c.type){case"touchstart":startX=e.pageX;a="mousedown";break;case"touchmove":c.preventDefault();a="mousemove";break;case"touchend":if(startX!==e.pageX){c.preventDefault()}a="mouseup";break;default:return}var b=document.createEvent("MouseEvent");b.initMouseEvent(a,true,true,window,1,e.screenX,e.screenY,e.clientX,e.clientY,false,false,false,false,0,null);e.target.dispatchEvent(b)}else{removeTouchEvents()}}function touchinit(){dojo.query(".dojoDndItem").connect("touchstart",touchSimulated);dojo.query(".dojoDndItem").connect("touchmove",touchSimulated);dojo.query(".dojoDndItem").connect("touchend",touchEnd);dojo.query(".locationThumb").connect("touchstart",touchHandle);dojo.query(".locationThumb").connect("touchmove",touchHandle);dojo.query(".locationThumb").connect("touchend",touchHandle);dojo.query(".dojoDndItem").connect("click",function(){void (0)});dojo.query(".dojoDndTarget").connect("touchstart",touchHandle);dojo.query(".dojoDndTarget").connect("touchmove",touchHandle);dojo.query(".dojoDndTarget").connect("touchend",touchHandle);dojo.query(".dijitSplitter").connect("touchstart",touchHandle);dojo.query(".dijitSplitter").connect("touchmove",touchHandle);dojo.query(".dijitSplitter").connect("touchend",touchHandle)}function loadTouch(){touchinit();document.documentElement.style.webkitTouchCallout="none"}function findPos(c){var b=0,a={};if(c.offsetParent){do{b+=c.offsetTop}while((c=c.offsetParent))}a.top=b;return a};